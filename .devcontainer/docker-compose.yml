version: '3.8'

services:
  devcontainer:
    build:
      context: .
      dockerfile: Dockerfile

    volumes:
      # プロジェクトルートをマウント（cachedオプションでパフォーマンス最適化）
      - ..:/workspace:cached

    # コンテナを永続化（VS Codeが接続するため）
    command: sleep infinity

    # ネットワーク設定（既存PostgreSQL等と同一ネットワーク）
    networks:
      - ubiquitous-lang-network

    # PostgreSQL起動を待機
    depends_on:
      - postgres

    # セキュリティ設定
    security_opt:
      - seccomp:unconfined

    # 環境変数
    environment:
      # タイムゾーン設定
      TZ: Asia/Tokyo

    # リソース制限（オプション）
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '2.0'
    #       memory: 4G

  # PostgreSQL設定（DevContainer専用のcontainer_name）
  postgres:
    container_name: devcontainer-postgres

  pgadmin:
    container_name: devcontainer-pgadmin

  smtp4dev:
    container_name: devcontainer-smtp4dev

networks:
  ubiquitous-lang-network:
    external: true
    name: ubiquitous-lang-mng_ubiquitous-lang-network
