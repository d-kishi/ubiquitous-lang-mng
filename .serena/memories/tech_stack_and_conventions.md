# 技術スタック・規約（技術的発見反映）

## 認証テスト問題の技術的発見（2025-09-03）

### Phase A3→A8実装進化問題
**発見事実**:
- Phase A3: スタブ実装前提のテスト設計
- Phase A8: 本格実装完了だがテスト未更新
- 結果: 実装・テスト間の深刻な乖離

### テスト統合最適化パターン
**成功パターン**:
```
統合前: 23件テスト（重複多数）
統合後: 10件テスト（57%削減）
効果: 実行時間70-80%短縮・保守性向上
```

### AuthApiController技術パターン
**TECH-006解決パターン**:
- HTTPコンテキスト分離による根本解決
- SignalRとは独立した新しいHTTPコンテキスト
- Cookie操作・ヘッダー設定の安全な実行

### テスト環境対応パターン
**null許容・環境依存対応**:
```csharp
if (superUser == null) {
    Assert.True(true, "テスト環境では初期データが未作成の場合がある");
    return;
}
```

### 仕様準拠テスト設計原則
- 肯定的仕様テスト: 実装すべき機能の確認
- 否定的仕様テスト: 実装しない機能の確認
- 初期パスワード"su"統一・ロックアウト機能なし等