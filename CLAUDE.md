# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

**ユビキタス言語管理システム**のプロジェクトです。ドメイン駆動設計（DDD）における用語管理を効率化するWebアプリケーションの開発を目的としています。現在は**実装フェーズ**で、Phase A1（基本認証システム）実装開始準備が完了しています。

### プロジェクト構造
- **実装フェーズ進行中**: 設計完了・雛型作成完了・縦方向スライス実装開始準備完了
- **技術基盤**: Clean Architecture（F# Domain/Application + C# Infrastructure/Web + Contracts層）
- **対象ユーザー**: プロジェクト管理者、ドメインエキスパート、DDD開発者

## アーキテクチャ・設計決定

### 主要な設計決定（ADR）
- **ADR_003**: 用語統一 - 日本語では「用語」ではなく「ユビキタス言語」を使用
- **ADR_001**: 図表にMermaid記法を採用
- **ADR_002**: MermaidのER図記法統一
- **ADR_004**: コミュニケーション課題状態管理システム
- **ADR_005**: PostgreSQL Docker Container採用（データ移行コスト削除）

### データベース設計
- **全環境共通**: PostgreSQL（Docker Container → クラウドDBサービス）
- **データ移行**: 不要（全環境PostgreSQL統一により）
- **アーキテクチャ**: Clean Architectureによるレイヤード構造
- **データ階層**: 組織 → プロジェクト → ドメイン → ユビキタス言語
- **PostgreSQL最適化**: TIMESTAMPTZ、JSONB、GINインデックス等固有機能活用

## コミュニケーション・セッション管理

### 🎯 **基本方針**

セッション管理の目的は、**効率的な情報共有と品質保証**です。AutoCompact対策として、定型的なプロセスは全てHooksスクリプトに実装し、確実な実行を保証します。

### 🤖 **Hooks実装による自動化**

**定型的なセッション管理プロセスは以下のHooksスクリプトで自動実行**：

1. **session_start_hook.sh**: セッション開始時の必読プロセス
2. **dynamic_loading_hook.sh**: 動的読み込み決定プロセス
3. **session_end_hook.sh**: セッション終了時確認プロセス
4. **session_record_hook.sh**: セッション終了時記録チェックリスト

### 📋 **セッション管理の原則**

#### **効率化の指針**
- **5分以内の迅速な状況把握**（必読プロセス）
- **3-5分の動的読み込み決定**（作業範囲特定）
- **体系的な記録・継承**（次回セッションへの確実な引き継ぎ）

#### **品質保証の考え方**
- **目的達成度の定量評価**（100%/80%/60%等）
- **継続課題の確実な追跡**（見落とし防止）
- **技術的知見の蓄積**（学習事項・ベストプラクティス）

#### **AutoCompact対策**
- **重要な情報はファイルに記録**（対話履歴に依存しない）
- **定型手順のスクリプト化**（確実な実行保証）
- **継続性確保**（セッション間の情報継承）

### 📚 **関連文書**

- **課題管理**: `/Doc/06_Issues/コミュニケーション改善課題.md`
- **記録テンプレート**: `/Doc/04_Daily/セッション終了時記録テンプレート.md`
- **組織管理**: [ADR_013: 組織管理サイクル運用規則](/Doc/07_Decisions/ADR_013_組織管理サイクル運用規則.md)

### 🔄 **継続的改善**

セッション管理手法は、日次記録での継続的発見・管理により改善を継続します。現在すべてのコミュニケーション課題（COM-001～004）が解決済みです。

## 実装指針

### 🎯 **重要**: Blazor Server・F#初学者対応コメント徹底

プロジェクトオーナーがBlazor ServerとF#の初学者のため、これらの分野では**特に詳細なコメント**を必須とする。

**📋 詳細仕様**: [ADR_010: 実装規約](/Doc/07_Decisions/ADR_010_実装規約.md)

**🎯 実装時の重要ポイント**:
- **Blazor Server**: コンポーネントライフサイクル・StateHasChanged・SignalR接続の詳細コメント必須
- **F#**: パターンマッチング・Option型・Result型・関数型プログラミング概念の説明必須
- **ドキュメント継承**: C#では`/// <inheritdoc/>`活用、F#では`<seealso>`タグ活用

### 📋 開発コマンド

#### **ビルドコマンド**
```bash
# 全プロジェクトビルド
dotnet build

# 特定プロジェクトのビルド
dotnet build src/UbiquitousLanguageManager.Web
```

#### **テストコマンド**
```bash
# 全テスト実行
dotnet test

# 特定テストプロジェクトのみ実行
dotnet test tests/UbiquitousLanguageManager.Tests
```

#### **開発サーバー起動**
```bash
# Webアプリケーション起動
dotnet run --project src/UbiquitousLanguageManager.Web

# Docker環境でのPostgreSQL起動
docker-compose up -d postgresql
```

#### **その他のコマンド**
```bash
# NuGetパッケージ復元
dotnet restore

# プロジェクトクリーン
dotnet clean
```

## ファイル構成

- `/Doc/01_Requirements/` - 要件・仕様書
- `/Doc/02_Design/` - システム・データベース設計
- `/Doc/03_Meetings/` - 会議録・申し送り事項
- `/Doc/04_Daily/` - 日次作業記録・進捗
- `/Doc/06_Issues/` - 課題追跡・解決
- `/Doc/07_Decisions/` - アーキテクチャ決定記録（ADR）
- `/Doc/08_Organization/` - Phase適応型組織設計・実績記録

## 重要事項

- **用語統一**: 日本語では「用語」ではなく「ユビキタス言語」を使用
- **セッション効率化**: 上記読み込みガイドに従って迅速な状況把握
- **課題追跡**: 問題発生時はコミュニケーション改善課題ファイルを更新
- **決定記録**: 重要な技術決定はADRとして記録

## 【MUST GLOBAL】開発手法の正式採用

### 🏆 戦略的アプローチ（Phase適応型組織化）
**2025-07-08実験結果＋2025-07-13 Claude Code Max Plan統合による正式採用**

#### **Phase分割による段階的問題解決**
複雑な技術課題を以下の段階に分割し、**Phase適応型並列組織**で体系的に解決：

1. **Phase 1: 設計理解と構造整理（並列分析）**
   - 既存プロジェクト構造の完全把握（プロジェクト間依存関係の図示）
   - 各層の責任範囲確認（F#↔C#境界の設計意図理解）
   - 最小構成での段階的構築（1つのエンティティに絞った縦方向実装）
   - Domain → Application → Contracts → Infrastructure → Web の順序
   - 各段階でのビルド成功確認

2. **Phase 2: 技術課題の特定と解決（並列解決）**
   - 根本原因の特定（症状ではなく原因への着手）
   - 体系的な解決アプローチ（場当たり的修正の回避）
   - F#構文パターンの標準化（クラス定義・member配置のベストプラクティス確立）
   - C#⇔F#連携の型変換システム確立（Contracts層での適切なDTO設計）
   - 段階的な検証・修正（各段階でのビルド成功確認）

3. **Phase 3: 品質向上と拡張（並列検証）**
   - 機能の充実化（基本構造確立後の機能追加）
   - 統合テストと品質保証
   - 実用レベルへの向上（各段階でのビルド成功確認）

#### **Phase適応型組織による構造化専門分析**
**Claude Code Max Plan Rate Limit活用**：Phase特性に応じた専門チーム役割による構造化分析・実装

**組織管理システム**：
- **記録場所**: `/Doc/08_Organization/` - 組織設計・実績・パターン集
- **実行サイクル**: Phase開始前組織設計 → 実行中効果測定 → 完了後パターン蓄積
- **Phase特性による専門役割数調整**:
  - シンプルPhase: 3-4専門役割
  - 中程度Phase: 4-6専門役割  
  - 複雑Phase: 6-8専門役割

**構造化分析プロセス**: step_start_hook.shに実装済み（Step1で自動実行）

#### **効果実績・目標**
- **従来手法**: 50%短縮・成功率100%実績（2025-07-08）
- **構造化組織目標**: 専門性向上・課題網羅性向上・品質向上実現（2025-07-13～）
- **品質**: 場当たり的修正を回避し、体系的解決を実現

### 🤝 Claude Code × Gemini連携（正式採用）

**詳細な実践ガイド**: [Gemini連携実践ガイド](/Doc/09_Environment/Gemini連携実践ガイド.md)を参照

#### **基本方針**
- **ユーザーの要求を受けたら即座に`gemini -p <質問内容>`で壁打ち**を必ず実施
- Geminiの意見を鵜呑みにせず、1意見として判断。聞き方を変えて多角的な意見を抽出
- **Claude Code内蔵のWebSearchツールは使用しない**
- **o3 MCPツール使用禁止**: 現在o3 MCPは登録済みだが有効化されていないため使用不可

#### **三位一体の開発原則**
- **ユーザー**：プロジェクトの目的・要件・最終ゴールを定義し、最終的な意思決定を行う**意思決定者**
- **Claude**：高度な計画力・高品質な実装・リファクタリング・ファイル操作・タスク管理を担う**実行者**
- **Gemini**：深いコード理解・Web検索による最新情報へのアクセス・多角的な視点からの助言・技術的検証を行う**助言者**

#### **主要な活用場面**
1. **技術調査**: 最新情報・エラー解決・ドキュメント検索・調査方法の確認
2. **設計検証**: アーキテクチャ・実装方針の妥当性確認
3. **コードレビュー**: 品質・保守性・パフォーマンスの評価
4. **計画立案**: タスクの実行計画レビュー・改善提案
5. **前提確認**: ユーザー、Claude自身に思い込みや勘違い、過信がないかどうか逐一確認

### 🔄 スクラム開発サイクル（正式採用）
**2025-07-09決定：縦方向スライス実装での標準開発サイクル**

**📋 詳細仕様**: [ADR_011: スクラム開発サイクル採用](/Doc/07_Decisions/ADR_011_スクラム開発サイクル採用.md)

**開発サイクル**: `計画 → 実装 → テスト → フィードバック → 修正 → テスト → ...`

**対象**: 縦方向スライス実装（ユーザー管理・プロジェクト管理・ドメイン管理・ユビキタス言語管理）

### 📈 継続的改善の実施
**session_record_hook.sh**により自動化済み：問題発見・改善案策定・効果測定・知見蓄積

### 📋 週次振り返りでの体系見直し
**weekly_review_hook.sh**により自動化済み：CLAUDE.md妥当性チェック・ドキュメント運用評価・セッション管理最適化・プロセス改善提案・文書合理化チェック