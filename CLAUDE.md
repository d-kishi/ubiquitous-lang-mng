# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

**ユビキタス言語管理システム**のプロジェクトです。ドメイン駆動設計（DDD）における用語管理を効率化するWebアプリケーションの開発を目的としています。現在は**実装フェーズ**で、Phase A1（基本認証システム）実装開始準備が完了しています。

### プロジェクト構造
- **実装フェーズ進行中**: 設計完了・雛型作成完了・縦方向スライス実装開始準備完了
- **技術基盤**: Clean Architecture（F# Domain/Application + C# Infrastructure/Web + Contracts層）
- **対象ユーザー**: プロジェクト管理者、ドメインエキスパート、DDD開発者

## アーキテクチャ・設計決定

### 主要な設計決定（ADR）
- **ADR_003**: 用語統一 - 日本語では「用語」ではなく「ユビキタス言語」を使用
- **ADR_001**: 図表にMermaid記法を採用
- **ADR_002**: MermaidのER図記法統一
- **ADR_004**: コミュニケーション課題状態管理システム
- **ADR_005**: PostgreSQL Docker Container採用（データ移行コスト削除）

### データベース設計
- **全環境共通**: PostgreSQL（Docker Container → クラウドDBサービス）
- **データ移行**: 不要（全環境PostgreSQL統一により）
- **アーキテクチャ**: Clean Architectureによるレイヤード構造
- **データ階層**: 組織 → プロジェクト → ドメイン → ユビキタス言語
- **PostgreSQL最適化**: TIMESTAMPTZ、JSONB、GINインデックス等固有機能活用

## コミュニケーション・セッション管理

### 🔴 セッション開始時必読（5分以内・標準プロセス）
**毎セッション開始時に必ず以下の順序で実施**:

⚠️ **Phase開始時（各PhaseのSession1）追加必読**：
- `/Doc/07_Decisions/ADR_012_階層構造統一ルール.md` - 階層構造の統一ルール
1. `/CLAUDE.md` - プロジェクト概要・技術構成・フェーズ状況
2. `/Doc/プロジェクト状況.md` - 最新状況・次回予定・重要な制約（簡潔な現状把握）
3. `/Doc/04_Daily/` 直近2日の作業記録 - 詳細履歴・継続課題・技術的文脈確認
4. **進捗状況・優先事項提示によるセッション目的確認**
   - 読み込んだ情報から現在の進捗状況を整理・提示
   - 今回の優先事項・推奨作業内容を提示
   - ユーザーに今回のセッション目的を明確化してもらう

### 🟡 動的読み込み決定プロセス（3-5分）

#### **Phase 1: 作業範囲特定（1-2分）**
ユーザーとの対話で以下を決定：
```
□ 今回の作業内容・目的確認
□ 必要ADR特定（例: 認証実装 → ADR_007, ADR_010）
□ 必要設計書特定（例: 認証UI → UI設計/01_認証・ユーザー管理画面設計.md）
□ 組織設計適用有無（Phase適応型組織使用するか）
□ 環境・課題情報の必要性確認
```

#### **Phase 2: 選択的読み込み実行（2-3分）**
決定した範囲のみ読み込み実行

### 📋 読み込み対象カテゴリ

#### **ADR（アーキテクチャ決定記録）**
作業内容に応じて選択：
- **ADR_001-003**: 基本記法・用語統一
- **ADR_007-009**: エラーハンドリング・ログ・テスト
- **ADR_010**: 実装規約（Blazor Server・F#コメント）
- **ADR_011**: スクラム開発サイクル
- **ADR_012**: 階層構造統一ルール（**Phase開始時必読**）
- **ADR_013**: 組織管理サイクル運用規則（**実装フェーズ必読**）

#### **設計書**
作業対象に応じて選択：
- **システム設計書.md**: アーキテクチャ全体
- **データベース設計書.md**: DB関連作業
- **Application層インターフェース設計書.md**: F#↔C#境界
- **UI設計/**: 該当画面設計書

#### **組織・環境・課題**
必要に応じて選択：
- **/Doc/08_Organization/Active/**: Phase適応型組織実行時
- **/Doc/09_Environment/**: 環境設定・DB接続作業時
- **/Doc/06_Issues/課題一覧.md**: 問題解決・技術調査時
- **/Doc/06_Issues/コミュニケーション改善課題.md**: コミュニケーション問題発生時・プロセス改善検討時

### 📋 フェーズ別推奨パターン（参考）

#### **実装フェーズ推奨**
🔴 必読 + ADR_012（階層構造統一ルール） + **`/Doc/08_Organization/Rules/組織管理運用マニュアル.md`** + 関連ADR + 作業対象設計書 + 組織設計（Phase適応型使用時）

🚨 **Step2以降実行時必須**: 組織管理運用マニュアルのチェックリスト必須実行・完了報告・ユーザー承認取得

🚨 **Step終了時必須**: 組織管理運用マニュアルの組織レビュー・次Step組織設計チェックリスト必須実行・段階別報告・承認取得

#### **レビュー・修正フェーズ推奨**  
🔴 必読 + ADR_012（階層構造統一ルール） + **`/Doc/08_Organization/Rules/組織管理運用マニュアル.md`** + 品質関連ADR + 関連設計書 + 組織設計 + 直近実装記録

### 🔚 セッション終了時確認プロセス
**セッション目的達成時に必ず実施**:
- **目的達成確認**: セッション開始時に設定した目的が達成されたかClaudeが判断・報告
- **Step終了時チェック**: Step完了の場合、ADR_013の組織レビュー・次Step組織設計チェックリスト実行
- **終了確認**: 目的達成をユーザーに報告し、セッション終了するかどうか確認を取る
- **継続判断**: ユーザーが継続を希望する場合は新たな目的設定を依頼
- **プロジェクト状況更新**: `/Doc/プロジェクト状況.md`の「次回セッション最優先事項」「次回Session読み込み推奨範囲」を自動更新

### 📝 セッション終了時記録チェックリスト

#### **🎯 成果・実績記録**
```
□ 今回セッションの主要成果整理（具体的な完了項目・創出物）
□ 完了・未完了事項の明確化（ToDoリスト状況・継続課題）
□ 技術的知見・学習事項の記録（新発見・ベストプラクティス）
□ 問題解決の経緯記録（エラー対応・解決手法・回避策）
```

#### **🔍 品質・効率評価**
```
□ セッション目的達成度評価（100%/80%/60%等の定量評価）
□ 時間効率測定（予定時間vs実際時間・効率化要因）
□ 適用手法の効果検証（Phase適応型組織・Gemini連携等の効果）
□ 品質評価（成果物品質・プロセス品質・満足度）
```

#### **📋 課題・改善管理**
```
□ 発見された課題・問題点の記録（技術的・プロセス的・コミュニケーション）
□ 継続課題の更新（解決済みマーク・新規追加・優先度変更）
□ コミュニケーション改善事項の確認（COM-XXX課題の状況更新）
□ プロセス改善提案（次回セッション以降の改善案）
```

#### **🚀 次回準備・引き継ぎ**
```
□ 次回セッション予定事項の設定（具体的作業内容・準備事項）
□ 申し送り事項の更新（重要な制約・前提・注意点）
□ 技術的前提条件の整理（開発環境・依存関係・設定状況）
□ Phase状況の更新（現在Phase・次Phase・実装計画）
```

#### **📄 記録・文書化**
```
□ `/Doc/04_Daily/YYYY-MM/YYYY-MM-DD-{セッション番号}-{セッション概要}.md`に詳細記録
□ 重要な決定事項のADR化検討（技術選定・アーキテクチャ決定等）
□ `/Doc/プロジェクト状況.md`の次回セッション情報更新（最優先事項・推奨読み込み範囲）
□ 週次総括への反映事項確認（週末セッションの場合）
```

### 📋 セッション終了時記録

詳細な記録テンプレートは以下を参照：
**`/Doc/04_Daily/セッション終了時記録テンプレート.md`**

日次作業記録ファイル（`/Doc/04_Daily/YYYY-MM/YYYY-MM-DD.md`）にテンプレートに従って記録を作成。

### 課題管理体制
現在すべてのコミュニケーション課題が解決済み（[詳細](/Doc/Archive/解決済みコミュニケーション課題.md)）。新たな課題管理は以下で実施：
- **詳細管理**: `/Doc/06_Issues/コミュニケーション改善課題.md`
- **新規課題**: セッション終了時記録での継続的発見・管理

## 実装指針

### 🎯 **重要**: Blazor Server・F#初学者対応コメント徹底

プロジェクトオーナーがBlazor ServerとF#の初学者のため、これらの分野では**特に詳細なコメント**を必須とする。

**📋 詳細仕様**: [ADR_010: 実装規約](/Doc/07_Decisions/ADR_010_実装規約.md)

**🎯 実装時の重要ポイント**:
- **Blazor Server**: コンポーネントライフサイクル・StateHasChanged・SignalR接続の詳細コメント必須
- **F#**: パターンマッチング・Option型・Result型・関数型プログラミング概念の説明必須
- **ドキュメント継承**: C#では`/// <inheritdoc/>`活用、F#では`<seealso>`タグ活用

### 📋 開発コマンド

#### **ビルドコマンド**
```bash
# 全プロジェクトビルド
dotnet build

# 特定プロジェクトのビルド
dotnet build src/UbiquitousLanguageManager.Web
```

#### **テストコマンド**
```bash
# 全テスト実行
dotnet test

# 特定テストプロジェクトのみ実行
dotnet test tests/UbiquitousLanguageManager.Tests
```

#### **開発サーバー起動**
```bash
# Webアプリケーション起動
dotnet run --project src/UbiquitousLanguageManager.Web

# Docker環境でのPostgreSQL起動
docker-compose up -d postgresql
```

#### **Phase A3: メール送信基盤開発コマンド**
```bash
# SMTP開発サーバー起動（Docker Composeで起動済み）
# docker-compose up -d smtp4dev

# メール送信関連テスト実行
dotnet test --filter "ClassName~Email"

# 統合テスト実行（Smtp4dev起動必須）
dotnet test tests/UbiquitousLanguageManager.Tests/Integration/EmailServiceIntegrationTests.cs

# SMTP Web インターフェース確認
# http://localhost:5080 でメール送信状況を確認
```

#### **その他のコマンド**
```bash
# NuGetパッケージ復元
dotnet restore

# プロジェクトクリーン
dotnet clean
```

## ファイル構成

- `/Doc/01_Requirements/` - 要件・仕様書
- `/Doc/02_Design/` - システム・データベース設計
- `/Doc/03_Meetings/` - 会議録・申し送り事項
- `/Doc/04_Daily/` - 日次作業記録・進捗
- `/Doc/06_Issues/` - 課題追跡・解決
- `/Doc/07_Decisions/` - アーキテクチャ決定記録（ADR）
- `/Doc/08_Organization/` - Phase適応型組織設計・実績記録

## 重要事項

- **用語統一**: 日本語では「用語」ではなく「ユビキタス言語」を使用
- **セッション効率化**: 上記読み込みガイドに従って迅速な状況把握
- **課題追跡**: 問題発生時はコミュニケーション改善課題ファイルを更新
- **決定記録**: 重要な技術決定はADRとして記録

## 【MUST GLOBAL】開発手法の正式採用

### 🏆 開発手法の正式採用

**Phase適応型組織化・Claude Code × Gemini連携・スクラム開発サイクル**を正式採用し運用中。

**📋 詳細手法**: [開発手法詳細ガイド](/Doc/08_Organization/Rules/開発手法詳細ガイド.md)を参照

### 📋 週次振り返りでの体系見直し

#### 🔍 定量的文書品質チェック（2025-07-21改善）
週次総括時に以下の定量的指標で継続的改善を実施：

**📊 文書肥大化早期発見**:
```
□ ADRファイル行数チェック（300行超で要分離検討）
□ CLAUDE.md行数チェック（400行超で要合理化検討）
□ プロジェクト状況.md行数チェック（200行超で要整理検討）
□ 各種マニュアル行数チェック（500行超で要分割検討）
```

**🎯 役割逸脱・重複検知**:
```
□ ADR本来の役割チェック（決定事項・背景・影響範囲に集約されているか）
□ 詳細運用情報の適切分離（Rules配下等への分離状況確認）
□ 文書間情報重複チェック（同一情報の複数箇所記載排除）
□ ファイル命名・配置適切性（役割に応じた適切な場所への配置）
```

#### 🔄 プロセス効率性評価（強化版）
**📈 セッション効率指標**:
```
□ セッション開始時読み込み時間（5分以内目標）
□ 必要情報到達効率（3クリック以内アクセス目標）
□ チェックリスト実行効率（Step終了時15分以内目標）
□ 文脈復元効率（Step2以降実行前10分以内目標）
```

**🎨 組織管理体系評価**:
```
□ Rules配下文書の活用頻度・効率性確認
□ Phase実績テンプレート反映の妥当性確認
□ 新体系（Phase_XXディレクトリ）の運用効率測定
□ テストファースト開発体系の実践効果測定
```

#### 🚀 継続改善アクション（具体化）
**⚡ 即座改善（週次実行）**:
- 肥大化文書の分離・合理化実行
- 重複情報の統合・削除
- 非効率プロセスの改善実装

**📋 中期改善（月次検討）**:
- 文書構造の抜本的見直し
- 新規ツール・手法の導入検討
- 開発効率向上施策の検討

**🔬 長期改善（四半期評価）**:
- プロジェクト全体の文書体系評価
- 開発手法・組織管理体系の効果測定
- 次期プロジェクトへの知見蓄積