# Phase A6 仕様準拠マトリックス

**作成日**: 2025-08-14  
**対象フェーズ**: Phase A6（認証システム統合完成）  
**用途**: spec-compliance Agent による仕様準拠監査基準  

## 監査対象仕様一覧

### 認証システム関連仕様（機能仕様書 2.0-2.1）

| 仕様ID | 仕様項目 | 仕様内容要約 | 実装必須度 | 検証方法 |
|-------|----------|------------|----------|----------|
| 2.0.1-1 | 初期スーパーユーザー：初期パスワード | 固定値「su」を使用 | 必須 | 設定ファイル確認・実際ログイン |
| 2.0.1-2 | 初期スーパーユーザー：自動登録 | システム初期化時自動実行 | 必須 | アプリケーション起動時確認 |
| 2.0.1-3 | 初期スーパーユーザー：重複防止 | 既存データ存在時はスキップ | 必須 | 複数回起動テスト |
| 2.0.1-4 | 初期スーパーユーザー：設定読込 | appsettings.jsonから読込 | 必須 | 設定ファイル変更テスト |
| 2.0.1-5 | 初期スーパーユーザー：初回フラグ | 初回ログイン時変更必須設定 | 必須 | IsFirstLoginフラグ確認 |
| 2.1.1-1 | ログイン：単一画面提供 | Blazor Server版のみ存在 | 必須 | URL直接アクセス・MVC版削除確認 |
| 2.1.1-2 | ログイン：認証方式 | メールアドレス・パスワード | 必須 | 認証機能動作確認 |
| 2.1.1-3 | ログイン：状態保持 | チェックボックス機能提供 | 必須 | 自動ログイン動作確認 |
| 2.1.1-4 | ログイン：成功時遷移 | ユビキタス言語一覧画面遷移 | 必須 | ログイン後画面確認 |
| 2.1.1-5 | ログイン：失敗時処理 | エラーメッセージ表示 | 必須 | 認証失敗テスト |
| 2.1.2-1 | パスワード変更：初回必須 | 全ユーザー（スーパーユーザー含む）初回必須 | 必須 | 初回ログイン強制遷移確認 |
| 2.1.2-2 | パスワード変更：現在認証 | 現在パスワードによる認証 | 必須 | パスワード変更機能テスト |
| 2.1.2-3 | パスワード変更：確認入力 | 新パスワード2回入力確認 | 必須 | 入力フォーム動作確認 |
| 2.1.2-4 | パスワード変更：要件確認 | 8文字以上・英数字混在推奨 | 必須 | バリデーション動作確認 |

## 技術負債解消準拠マトリックス

### TECH-002: 初期スーパーユーザーパスワード仕様不整合

| 準拠項目 | 現状 | 目標 | 確認方法 | ステータス |
|---------|------|------|----------|----------|
| appsettings.json設定 | "TempPass123!" | "su" | ファイル内容確認 | 要対応 |
| appsettings.Development.json設定 | "su" | "su" | ファイル内容確認 | ✅完了 |
| 実際のログイン動作 | 環境により異なる | suで認証 | 実ログインテスト | 要対応 |
| 開発ドキュメント整合性 | 記載不一致 | 記載統一 | ドキュメント確認 | 要対応 |

### TECH-003: ログイン画面重複統合

| 準拠項目 | 現状 | 目標 | 確認方法 | ステータス |
|---------|------|------|----------|----------|
| MVC版ログイン画面 | 存在・動作中 | 完全削除 | /Account/Login アクセス確認 | 要対応 |
| Blazor版ログイン画面 | 表示のみ・機能不全 | 完全動作 | /login でのログイン成功確認 | 要対応 |
| AccountController | Login ActionMethod存在 | 削除完了 | コード確認 | 要対応 |
| Login.cshtml View | ファイル存在 | ファイル削除 | ファイル存在確認 | 要対応 |
| 認証統合性 | MVC/Blazor分離 | Blazor統合 | 認証フロー一貫性確認 | 要対応 |

### TECH-004: 初回ログインパスワード変更未実装

| 準拠項目 | 現状 | 目標 | 確認方法 | ステータス |
|---------|------|------|----------|----------|
| 初回ログイン判定 | 未実装 | IsFirstLoginフラグ判定実装 | 初回ログイン時動作確認 | 要対応 |
| パスワード変更強制遷移 | 未実装 | 初回時自動遷移実装 | 画面遷移動作確認 | 要対応 |
| 他画面アクセス制限 | 未実装 | 初回中は制限実装 | 直接URL アクセステスト | 要対応 |
| フラグ更新処理 | 未実装 | パスワード変更完了時更新 | IsFirstLogin更新確認 | 要対応 |
| UI設計書誤記 | 「スーパーユーザー以外」記載 | 「全ユーザー」記載 | ドキュメント内容確認 | 要対応 |

## 仕様準拠確認チェックリスト

### 📋 Phase A6完了時確認項目

#### 基本機能確認
- [ ] **初期スーパーユーザー登録**
  - [ ] 新規環境で初期パスワード「su」でログイン成功
  - [ ] 複数回アプリ起動時の重複登録回避確認
  - [ ] appsettings.json からの設定読み込み確認
  
- [ ] **ログイン機能統合**
  - [ ] `/login` でのBlazor版ログイン画面正常動作
  - [ ] `/Account/Login` へのアクセス時404エラー表示
  - [ ] ログイン状態保持機能正常動作
  - [ ] 認証成功時のユビキタス言語一覧画面遷移
  
- [ ] **初回パスワード変更機能**
  - [ ] 初回ログイン時のパスワード変更画面強制遷移
  - [ ] パスワード変更完了まで他画面アクセス制限
  - [ ] パスワード変更完了後のIsFirstLoginフラグ更新
  - [ ] スーパーユーザーでも初回変更必須動作

#### 品質確認
- [ ] **ビルド・テスト**
  - [ ] アプリケーション全体の正常ビルド（0 Warning, 0 Error）
  - [ ] 既存単体テスト全項目成功
  - [ ] 既存統合テスト全項目成功
  - [ ] 新規追加テスト全項目成功
  
- [ ] **非機能要件**
  - [ ] ログイン処理の応答速度3秒以内
  - [ ] パスワード変更処理の応答速度3秒以内
  - [ ] セキュリティ要件の維持
  
#### ドキュメント整合性
- [ ] **設計書修正**
  - [ ] UI設計書の誤記修正完了
  - [ ] 技術負債ドキュメントのステータス更新
  - [ ] 開発環境構築ガイドの更新
  
- [ ] **仕様準拠記録**
  - [ ] 全仕様項目の準拠度チェック完了
  - [ ] 逸脱項目なしの確認
  - [ ] spec-compliance Agent による最終監査合格

## 監査実行指針

### spec-compliance Agent向け実行手順
1. **静的確認**: 設定ファイル・コード・ドキュメント内容の仕様準拠確認
2. **動的確認**: アプリケーション実行による動作確認
3. **統合確認**: 既存機能への影響なし・全体的整合性確認
4. **文書確認**: 関連ドキュメントの更新・整合性確認

### 合格基準
- 全チェック項目の100%達成
- 技術負債TECH-002～004の完全解消
- 既存機能への悪影響なし
- Phase B1移行準備の完全整備

### 不合格時の対応
- 不合格項目の詳細記録・原因分析
- 修正方針の策定・実装
- 再監査の実施・合格確認