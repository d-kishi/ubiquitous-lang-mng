# Step6 çµ±åˆåˆ†æçµæœ: 6å°‚é–€å½¹å‰²ã«ã‚ˆã‚‹åŒ…æ‹¬çš„å•é¡Œè§£æ±º

**å®Ÿè¡Œæ—¥**: 2025-07-28  
**å¯¾è±¡**: Phase A3 Step6 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆãƒ»å®Ÿè£…æ•´åˆæ€§ä¿®æ­£  
**åˆ†ææ–¹å¼**: ADR_013æº–æ‹  6å°‚é–€å½¹å‰²ä¸¦åˆ—åˆ†æä½“åˆ¶  
**çµ„ç¹”æ§‹æˆ**: è¤‡é›‘Phaseå¯¾å¿œï¼ˆæŠ€è¡“é ˜åŸŸæ¨ªæ–­ãƒ»ä¾å­˜é–¢ä¿‚å¤šæ•°ãƒ»å“è³ªå½±éŸ¿å¤§ï¼‰  

## ğŸ“Š 6å°‚é–€å½¹å‰²å€‹åˆ¥åˆ†æçµæœ

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒå°‚é–€å®¶åˆ†æçµæœ

#### ğŸš¨ **è¨­è¨ˆæ›¸vså®Ÿè£…ã®å®Œå…¨ä¸æ•´åˆç™ºè¦‹**

**AspNetUsersãƒ†ãƒ¼ãƒ–ãƒ«é‡å¤§å•é¡Œ:**
- **è¨­è¨ˆæ›¸å¿…é ˆåˆ—ä¸è¶³**: `PasswordResetToken TEXT NULL`, `PasswordResetExpiry TIMESTAMPTZ NULL`
- **Phase A3å½±éŸ¿**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½å®Œå…¨å®Ÿè£…ä¸å¯
- **ä½™è¨ˆãªåˆ—å­˜åœ¨**: `UserRole`, `DomainUserId`, `CreatedAt`, `CreatedBy` ç­‰ï¼ˆè¨­è¨ˆæ›¸ã«è¨˜è¼‰ãªã—ï¼‰

#### **ãƒ‡ãƒ¼ã‚¿ç§»è¡Œãƒªã‚¹ã‚¯è©•ä¾¡**
| ãƒªã‚¹ã‚¯é …ç›® | å½±éŸ¿ãƒ¬ãƒ™ãƒ« | å¯¾å‡¦æ³• |
|-----------|------------|--------|
| **æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿** | ğŸ”´ **é«˜** | ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—â†’æ‰‹å‹•ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ |
| **UserRoleåˆ—ã®ãƒ‡ãƒ¼ã‚¿** | ğŸŸ¡ **ä¸­** | AspNetRoles/AspNetUserRolesã«ç§»è¡Œ |
| **ã‚«ã‚¹ã‚¿ãƒ åˆ—ãƒ‡ãƒ¼ã‚¿** | ğŸŸ  **ä¸­** | ãƒ‡ãƒ¼ã‚¿ç§»è¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆå¿…è¦ |

#### **æ¨å¥¨ä¿®æ­£ãƒ—ãƒ©ãƒ³**
```bash
# Phase 1: ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
pg_dump -h localhost -U postgres -d ubiquitous_lang_db > backup_before_schema_fix.sql

# Phase 2: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‰Šé™¤ãƒ»å†ä½œæˆ
rm -rf src/UbiquitousLanguageManager.Infrastructure/Data/Migrations/*
dotnet ef migrations add InitialCreate --project src/UbiquitousLanguageManager.Infrastructure

# Phase 3: è¨­è¨ˆæ›¸æº–æ‹ ã‚¹ã‚­ãƒ¼ãƒé©ç”¨
psql -h localhost -U postgres -d ubiquitous_lang_db -f init/01_create_schema.sql
```

### 2. ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ»ORMå°‚é–€å®¶åˆ†æçµæœ

#### **ApplicationUser.cs ä¿®æ­£è¦ä»¶**

**âœ… ç¶­æŒã™ã¹ããƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆè¨­è¨ˆæ›¸æº–æ‹ ï¼‰:**
```csharp
public string Name { get; set; } = string.Empty;
public bool IsFirstLogin { get; set; } = true;
public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
public bool IsDeleted { get; set; } = false;
public string? InitialPassword { get; set; }
```

**ğŸš¨ è¿½åŠ å¿…é ˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆPhase A3å¿…é ˆï¼‰:**
```csharp
/// <summary>
/// ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒˆãƒ¼ã‚¯ãƒ³ - ä»•æ§˜æ›¸2.1.3æº–æ‹ 
/// 24æ™‚é–“æœ‰åŠ¹æœŸé™ã§ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ã‚’æä¾›
/// </summary>
public string? PasswordResetToken { get; set; }

/// <summary>
/// ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ - ä»•æ§˜æ›¸2.1.3æº–æ‹ 
/// UTCåŸºæº–ã§24æ™‚é–“å¾Œã‚’è¨­å®š
/// </summary>
public DateTime? PasswordResetExpiry { get; set; }
```

**âŒ å‰Šé™¤å¯¾è±¡ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆè¨­è¨ˆæ›¸é•åï¼‰:**
```csharp
// ä»¥ä¸‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯è¨­è¨ˆæ›¸ã«å­˜åœ¨ã—ãªã„ä½™è¨ˆãªå®Ÿè£…
public DateTime CreatedAt { get; set; }
public string CreatedBy { get; set; }
public string UpdatedBy { get; set; }
public bool IsActive { get; set; }
public string Role { get; set; }
```

#### **EF Coreè¨­å®šæœ€é©åŒ–**
```csharp
// DbContextè¨­å®šè¿½åŠ è¦æ±‚
entity.Property(e => e.PasswordResetToken)
      .HasColumnType("text")
      .HasComment("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆPhase A3æ©Ÿèƒ½ï¼‰");

entity.Property(e => e.PasswordResetExpiry)
      .HasColumnType("timestamptz")
      .HasComment("ãƒªã‚»ãƒƒãƒˆãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ï¼ˆPhase A3æ©Ÿèƒ½ï¼‰");
```

### 3. ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ãƒ»TDDå°‚é–€å®¶åˆ†æçµæœ

#### **ç¾åœ¨ã®ãƒ†ã‚¹ãƒˆç ´ç¶»çŠ¶æ³**
- **ãƒ†ã‚¹ãƒˆç·æ•°**: 418ä»¶ï¼ˆPhase A3å®Œäº†æ™‚ç‚¹ï¼‰
- **å¤±æ•—ãƒ†ã‚¹ãƒˆ**: 125ä»¶ï¼ˆç´„30%å¤±æ•—ç‡ï¼‰
- **æˆåŠŸãƒ†ã‚¹ãƒˆ**: 289ä»¶ï¼ˆç´„69%æˆåŠŸç‡ï¼‰
- **æ ¹æœ¬åŸå› **: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆãƒ»å®Ÿè£…ä¸æ•´åˆã«ã‚ˆã‚‹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£é–¢é€£ãƒ†ã‚¹ãƒˆç ´ç¶»

#### **Red-Green-Refactorã‚µã‚¤ã‚¯ãƒ«ä¿®æ­£æˆ¦ç•¥**

**Phase 1: Red - å¤±æ•—ãƒ†ã‚¹ãƒˆç‰¹å®šãƒ»åˆ†æï¼ˆ60åˆ†ï¼‰**
```csharp
[Fact]
public void ApplicationUser_ShouldHavePasswordResetProperties()
{
    // Red: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ—ã¨ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®æ•´åˆæ€§ç¢ºèª
    var user = new ApplicationUser();
    
    // ã“ã‚Œã‚‰ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ—ã¨ä¸€è‡´ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
    Assert.True(typeof(ApplicationUser).GetProperty("PasswordResetToken") != null);
    Assert.True(typeof(ApplicationUser).GetProperty("PasswordResetExpiry") != null);
}
```

**Phase 2: Green - æœ€å°å®Ÿè£…ã«ã‚ˆã‚‹ä¿®æ­£ï¼ˆ240åˆ†ï¼‰**
1. ApplicationUserã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ä¿®æ­£ï¼ˆ60åˆ†ï¼‰
2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆï¼ˆ60åˆ†ï¼‰
3. ç ´ç¶»ãƒ†ã‚¹ãƒˆä¿®æ­£ï¼ˆ120åˆ†ï¼‰

**Phase 3: Refactor - å“è³ªå‘ä¸Šãƒ»ãƒ†ã‚¹ãƒˆæ‹¡å¼µï¼ˆ180åˆ†ï¼‰**
- ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸80%é”æˆæˆ¦ç•¥
- çµ±åˆãƒ†ã‚¹ãƒˆå¼·åŒ–
- Phase A3æ–°æ©Ÿèƒ½ã®TDDå®Ÿè·µ

#### **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸80%ç¶­æŒæˆ¦ç•¥**
- **Domainå±¤**: 90%ä»¥ä¸Šï¼ˆF#ç´”ç²‹é–¢æ•°ã®é«˜ãƒ†ã‚¹ãƒˆæ€§ï¼‰
- **Applicationå±¤**: 75%ï¼ˆPhase A3æ©Ÿèƒ½è¿½åŠ ã«ã‚ˆã‚Šä½ä¸‹ï¼‰
- **Infrastructureå±¤**: 70%ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±åˆãƒ†ã‚¹ãƒˆä¸è¶³ï¼‰
- **Webå±¤**: 60%ï¼ˆBlazor Serverã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆä¸è¶³ï¼‰

### 4. Phase A3æ©Ÿèƒ½å®Ÿè£…å°‚é–€å®¶åˆ†æçµæœ

#### **ç¾åœ¨ã®å®Ÿè£…å®Œæˆåº¦è©•ä¾¡**

**ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ï¼ˆå®Œæˆåº¦: 85%ï¼‰**
- âœ… `PasswordResetService.cs`: å®Œå…¨å®Ÿè£…æ¸ˆã¿
- âœ… ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆãƒ»æ¤œè¨¼ãƒ»ãƒªã‚»ãƒƒãƒˆãƒ­ã‚¸ãƒƒã‚¯å®Œæˆ
- ğŸš¨ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ—ä¸è¶³ã«ã‚ˆã‚Šå‹•ä½œä¸å¯ï¼ˆ15%ä¸è¶³ï¼‰

**Remember Meæ©Ÿèƒ½ï¼ˆå®Œæˆåº¦: 90%ï¼‰**
- âœ… `Login.razor`: UIãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹å®Ÿè£…æ¸ˆã¿
- âœ… 7æ—¥é–“Cookieè¨­å®šãƒ­ã‚¸ãƒƒã‚¯å®Œæˆ
- ğŸš¨ CookieæœŸé™ç®¡ç†ã®è©³ç´°æ¤œè¨¼å¿…è¦ï¼ˆ10%ä¸è¶³ï¼‰

**ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ©Ÿèƒ½ï¼ˆå®Œæˆåº¦: 95%ï¼‰**
- âœ… `SmtpEmailSender.cs`: å®Œå…¨å®Ÿè£…
- âœ… smtp4devé€£æºè¨­å®šå®Œäº†
- ğŸš¨ çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œå¿…è¦ï¼ˆ5%ä¸è¶³ï¼‰

#### **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ—è¿½åŠ å¾Œã®å®Œæˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**

**Session 1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åŸºç›¤ä¿®æ­£ï¼ˆ90åˆ†ï¼‰**
1. AspNetUsersãƒ†ãƒ¼ãƒ–ãƒ«åˆ—è¿½åŠ  (15åˆ†)
2. ApplicationUserã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ä¿®æ­£ (20åˆ†)
3. DbContextè¨­å®šç¢ºèªãƒ»ä¿®æ­£ (15åˆ†)
4. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œãƒ»ç¢ºèª (20åˆ†)
5. åŸºç›¤ãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒ»ä¿®æ­£ (20åˆ†)

**Session 2: UIå®Ÿè£…ãƒ»çµ±åˆï¼ˆ120åˆ†ï¼‰**
1. ForgotPassword.razorä½œæˆ (45åˆ†)
2. ResetPassword.razorä½œæˆ (45åˆ†)
3. ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ»ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š (20åˆ†)
4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°çµ±åˆ (10åˆ†)

**Session 3: çµ±åˆãƒ†ã‚¹ãƒˆãƒ»å“è³ªä¿è¨¼ï¼ˆ90åˆ†ï¼‰**
1. smtp4devç’°å¢ƒèµ·å‹•ãƒ»è¨­å®šç¢ºèª (15åˆ†)
2. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ•ãƒ­ãƒ¼å…¨ä½“ãƒ†ã‚¹ãƒˆ (30åˆ†)
3. Remember Meæ©Ÿèƒ½å‹•ä½œç¢ºèª (20åˆ†)
4. ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ (15åˆ†)
5. æœ€çµ‚å“è³ªç¢ºèªãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–° (10åˆ†)

### 5. Clean Architectureãƒ»F#â†”C#å¢ƒç•Œå°‚é–€å®¶åˆ†æçµæœ

#### **âœ… å®Ÿè£…å“è³ªè©•ä¾¡: Sç´šï¼ˆæœ€é«˜å“è³ªï¼‰**

**Clean Architectureå±¤æ§‹æˆ: Aç´š (95%å®Œäº†)**
- **Domainå±¤ (F#)**: å®Œå…¨å®Ÿè£… - Entityã€Value Objectã€åˆ¤åˆ¥å…±ç”¨ä½“ã«ã‚ˆã‚‹å …ç‰¢ãªãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«
- **Applicationå±¤ (F#)**: å®Œå…¨å®Ÿè£… - ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹åˆ†é›¢åŸå‰‡æº–æ‹ ã€RepositoryæŠ½è±¡åŒ–å®Œäº†
- **Contractså±¤ (C#)**: é«˜å“è³ªå®Ÿè£… - F#â†”C#å¢ƒç•Œã®å‹å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯573è¡Œã®åŒ…æ‹¬çš„å®Ÿè£…
- **Infrastructureå±¤ (C#)**: 95%å®Œäº† - ASP.NET Core Identityçµ±åˆã€EF Coreå®Ÿè£…å®Œäº†
- **Presentationå±¤ (C#)**: 90%å®Œäº† - Blazor Server UIå®Ÿè£…ã€èªè¨¼çµ±åˆå®Œäº†

**ä¾å­˜é–¢ä¿‚æ–¹å‘æ€§**: Clean ArchitectureåŸå‰‡100%æº–æ‹ 
```
Web/Infrastructure â†’ Contracts â†’ Application â†’ Domain
```

#### **F#â†”C#å¢ƒç•Œå®Ÿè£…ã®å„ªç§€æ€§**
1. **å®Œå…¨æ€§**: F# Optionå‹â†’C# Nullableã€F# Resultå‹â†’C# Resultå‹ç­‰ã®å…¨å¤‰æ›ãƒ‘ã‚¿ãƒ¼ãƒ³å®Ÿè£…
2. **å‹å®‰å…¨æ€§**: åˆ¤åˆ¥å…±ç”¨ä½“ã®å„ã‚±ãƒ¼ã‚¹ã«å¯¾ã™ã‚‹å®‰å…¨ãªå¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯
3. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: Resultå‹ã«ã‚ˆã‚‹åŒ…æ‹¬çš„ã‚¨ãƒ©ãƒ¼å‡¦ç†
4. **æ‹¡å¼µæ€§**: Phase A2å¯¾å¿œã®é«˜åº¦ãªæ¨©é™ã‚·ã‚¹ãƒ†ãƒ ãƒ»ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç®¡ç†å¯¾å¿œ

#### **ApplicationUserå¤‰æ›´ã®å½±éŸ¿è©•ä¾¡**
- **å½±éŸ¿åº¦**: è»½å¾®ï¼ˆContractså±¤ã®TypeConverters.csã¯é«˜å“è³ªå®Ÿè£…æ¸ˆã¿ï¼‰
- **å¯¾å¿œ**: ApplicationUserå¤‰æ›´ã«å¯¾ã™ã‚‹è‡ªå‹•å¯¾å¿œå¯èƒ½
- **F# Domainã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£**: å½±éŸ¿ãªã—

### 6. ä»•æ§˜æº–æ‹ ãƒ»å“è³ªä¿è¨¼å°‚é–€å®¶åˆ†æçµæœ

#### **ğŸš¨ Critical: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ vs å®Ÿè£…ã®å®Œå…¨ä¸æ•´åˆ**

**AspNetUsersãƒ†ãƒ¼ãƒ–ãƒ«ä»•æ§˜æº–æ‹ çŠ¶æ³**
| é …ç›® | è¨­è¨ˆæ›¸ä»•æ§˜ | å®Ÿè£…çŠ¶æ³ | æº–æ‹ çŠ¶æ³ | å½±éŸ¿åº¦ |
|------|------------|----------|----------|---------|
| **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ** | PasswordResetToken, PasswordResetExpiry | âŒ æœªå®Ÿè£… | ğŸš¨ Critical | Phase A3æ©Ÿèƒ½å®Œå…¨åœæ­¢ |
| **åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†** | InitialPassword | âœ… å®Ÿè£…æ¸ˆã¿ | âœ… æº–æ‹  | - |
| **è«–ç†å‰Šé™¤** | IsDeleted, deleted_at, deleted_by | âŒ deleted_at/deleted_byæœªå®Ÿè£… | ğŸš¨ High | ãƒ‡ãƒ¼ã‚¿ä¸€è²«æ€§ãƒªã‚¹ã‚¯ |
| **ç›£æŸ»ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰** | UpdatedBy (VARCHAR) | âŒ UpdatedBy (string) ä¸æ•´åˆ | ğŸš¨ High | ä»•æ§˜é•å |

#### **Phase A1-A3æ©Ÿèƒ½ä»•æ§˜æº–æ‹ ç¢ºèª**

**2.1.1 ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ï¼ˆæ©Ÿèƒ½ä»•æ§˜æ›¸ï¼‰**
| è¦ä»¶ | å®Ÿè£…çŠ¶æ³ | ãƒ†ã‚¹ãƒˆçŠ¶æ³ | æº–æ‹ åº¦ |
|------|----------|-----------|---------|
| ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ | âœ… å®Ÿè£… | âœ… ãƒ†ã‚¹ãƒˆæ¸ˆã¿ | 100% |
| Remember Meæ©Ÿèƒ½ | âœ… å®Ÿè£… | âŒ 125ä»¶å¤±æ•— | 60% |
| èªè¨¼æˆåŠŸæ™‚ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ | âœ… å®Ÿè£… | âŒ ãƒ†ã‚¹ãƒˆå¤±æ•— | 70% |

**2.1.3 ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ï¼ˆæ©Ÿèƒ½ä»•æ§˜æ›¸ï¼‰**
| è¦ä»¶ | è¨­è¨ˆæ›¸æº–æ‹  | å®Ÿè£…çŠ¶æ³ | ãƒ†ã‚¹ãƒˆçŠ¶æ³ | æº–æ‹ åº¦ |
|------|------------|----------|-----------|---------|
| **ãƒªã‚»ãƒƒãƒˆãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†** | âŒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æœªå®Ÿè£… | âŒ æ©Ÿèƒ½ä¸å®Œå…¨ | âŒ å¤±æ•— | 0% |
| **24æ™‚é–“æœ‰åŠ¹æœŸé™** | âŒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æœªå®Ÿè£… | âŒ æ©Ÿèƒ½ä¸å®Œå…¨ | âŒ å¤±æ•— | 0% |
| ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ©Ÿèƒ½ | âœ… è¨­è¨ˆæº–æ‹  | âœ… å®Ÿè£…æ¸ˆã¿ | âœ… æˆåŠŸ | 100% |

#### **å“è³ªä¿è¨¼åŸºæº–è©•ä¾¡**
- **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™**: 80%ä»¥ä¸Šç¶­æŒ
- **ç¾çŠ¶**: 418ãƒ†ã‚¹ãƒˆä¸­125ä»¶å¤±æ•—ï¼ˆ70%æˆåŠŸç‡ï¼‰
- **å“è³ªåŸºæº–**: ğŸš¨ ä¸é”æˆ

## ğŸ“Š çµ±åˆåˆ†æãƒ»å„ªå…ˆé †ä½ä»˜ã‘

### **åˆ†æçµæœçµ±åˆã‚µãƒãƒªãƒ¼**

| å°‚é–€å½¹å‰² | é‡è¦ç™ºè¦‹äº‹é … | å½±éŸ¿åº¦ | ä¿®æ­£ç·Šæ€¥åº¦ |
|----------|-------------|--------|------------|
| **DBå°‚é–€å®¶** | AspNetUsersåˆ—ä¸æ•´åˆãƒ»Phase A3æ©Ÿèƒ½å®Ÿè£…ä¸å¯ | ğŸš¨ Critical | å³åº§ |
| **ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å°‚é–€å®¶** | ApplicationUserä½™è¨ˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ»è¨­è¨ˆæ›¸é•å | ğŸŸ¡ Medium | é«˜ |
| **ãƒ†ã‚¹ãƒˆå°‚é–€å®¶** | 125ä»¶ãƒ†ã‚¹ãƒˆå¤±æ•—ãƒ»TDDåŸºç›¤ç ´ç¶» | ğŸš¨ Critical | å³åº§ |
| **A3æ©Ÿèƒ½å°‚é–€å®¶** | Phase A3æ©Ÿèƒ½85-95%å®Œæˆãƒ»DBä¿®æ­£ã§100%é”æˆå¯èƒ½ | ğŸŸ  High | é«˜ |
| **CAå¢ƒç•Œå°‚é–€å®¶** | F#â†”C#å¢ƒç•Œã¯Sç´šå“è³ªãƒ»Clean Architecture100%æº–æ‹  | âœ… Good | ä½ |
| **å“è³ªä¿è¨¼å°‚é–€å®¶** | ä»•æ§˜æº–æ‹ ç‡60%ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸ã¨ã®é‡å¤§ä¸æ•´åˆ | ğŸš¨ Critical | å³åº§ |

### **ğŸ¯ æ ¹æœ¬å•é¡Œç‰¹å®š**

**æœ€é‡è¦ç™ºè¦‹**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸ã¨å®Ÿè£…ã®å®Œå…¨ä¸æ•´åˆãŒ**Phase A3ç¶™ç¶šã®è‡´å‘½çš„é˜»å®³è¦å› **

1. **AspNetUsersåˆ—ä¸è¶³**: PasswordResetToken/PasswordResetExpiry â†’ Phase A3ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½å®Œå…¨åœæ­¢
2. **é‡è¤‡ãƒ†ãƒ¼ãƒ–ãƒ«å•é¡Œ**: Users + AspNetUsersä¸¡æ–¹ä½œæˆ â†’ ãƒ‡ãƒ¼ã‚¿ä¸€è²«æ€§ç ´ç¶»
3. **125ä»¶ãƒ†ã‚¹ãƒˆå¤±æ•—**: ä¸Šè¨˜ä¸æ•´åˆã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆåŸºç›¤ç ´ç¶»

### **å½±éŸ¿åº¦ãƒ»ç·Šæ€¥åº¦ãƒãƒˆãƒªãƒƒã‚¯ã‚¹**

| å•é¡Œã‚«ãƒ†ã‚´ãƒª | å½±éŸ¿åº¦ | ç·Šæ€¥åº¦ | å¯¾å‡¦é †åº | å¿…è¦æ™‚é–“ |
|-------------|--------|--------|----------|----------|
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒä¸æ•´åˆ** | Critical | å³åº§ | 1ä½ | 2æ™‚é–“ |
| **ApplicationUserä¿®æ­£** | High | é«˜ | 2ä½ | 1æ™‚é–“ |
| **ãƒ†ã‚¹ãƒˆåŸºç›¤ä¿®æ­£** | Critical | å³åº§ | 3ä½ | 3æ™‚é–“ |
| **Phase A3æ©Ÿèƒ½å®Œæˆ** | High | é«˜ | 4ä½ | 2æ™‚é–“ |

## ğŸš€ çµ±åˆè§£æ±ºç­–ãƒ»å®Ÿè£…è¨ˆç”»

### **ğŸ“‹ Phase 1: ç·Šæ€¥ä¿®æ­£ï¼ˆCritical Priority - 2æ™‚é–“ï¼‰**

#### **1.1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒç·Šæ€¥ä¿®æ­£ï¼ˆ60åˆ†ï¼‰**
```bash
# Step 1: ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆå®‰å…¨ç¢ºä¿ï¼‰
pg_dump -h localhost -U postgres -d ubiquitous_lang_db > backup_step6.sql

# Step 2: æ—¢å­˜ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‰Šé™¤
rm -rf src/UbiquitousLanguageManager.Infrastructure/Data/Migrations/*

# Step 3: è¨­è¨ˆæ›¸æº–æ‹ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
dotnet ef migrations add CorrectInitialMigration --project src/UbiquitousLanguageManager.Infrastructure

# Step 4: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†ä½œæˆãƒ»é©ç”¨
dotnet ef database drop --force --project src/UbiquitousLanguageManager.Infrastructure
dotnet ef database update --project src/UbiquitousLanguageManager.Infrastructure
```

#### **1.2 ApplicationUserç·Šæ€¥ä¿®æ­£ï¼ˆ60åˆ†ï¼‰**
```csharp
public class ApplicationUser : IdentityUser
{
    // âœ… è¨­è¨ˆæ›¸æº–æ‹ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆç¶­æŒï¼‰
    public string Name { get; set; } = string.Empty;
    public bool IsFirstLogin { get; set; } = true;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    public bool IsDeleted { get; set; } = false;
    public string? InitialPassword { get; set; }
    
    // ğŸš¨ Phase A3å¿…é ˆè¿½åŠ ï¼ˆè¨­è¨ˆæ›¸æº–æ‹ ï¼‰
    public string? PasswordResetToken { get; set; }
    public DateTime? PasswordResetExpiry { get; set; }
    
    // âŒ å‰Šé™¤å¯¾è±¡ï¼ˆè¨­è¨ˆæ›¸ã«ãªã„ä½™è¨ˆå®Ÿè£…ï¼‰
    // public DateTime CreatedAt { get; set; }
    // public string CreatedBy { get; set; }
    // public string UpdatedBy { get; set; }
    // public bool IsActive { get; set; }
    // public string Role { get; set; }
}
```

### **ğŸ“‹ Phase 2: ãƒ†ã‚¹ãƒˆåŸºç›¤ä¿®æ­£ï¼ˆHigh Priority - 3æ™‚é–“ï¼‰**

#### **2.1 ç ´ç¶»ãƒ†ã‚¹ãƒˆä¿®æ­£ï¼ˆTDD Red-Green-Refactorï¼‰**
```csharp
// Red: ApplicationUserå¤‰æ›´ã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆå¤±æ•—ç¢ºèª
[Fact]
public void ApplicationUser_ShouldHaveCorrectProperties()
{
    var user = new ApplicationUser();
    Assert.NotNull(user.PasswordResetToken); // æœ€åˆã¯å¤±æ•—
    Assert.NotNull(user.PasswordResetExpiry); // æœ€åˆã¯å¤±æ•—
}

// Green: ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¿½åŠ ã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆæˆåŠŸ
// ApplicationUserä¿®æ­£ã«ã‚ˆã‚ŠæˆåŠŸ

// Refactor: ãƒ†ã‚¹ãƒˆæ‹¡å¼µãƒ»å“è³ªå‘ä¸Š
```

#### **2.2 çµ±åˆãƒ†ã‚¹ãƒˆä¿®æ­£**
- 125ä»¶å¤±æ•—ãƒ†ã‚¹ãƒˆã®ä½“ç³»çš„ä¿®æ­£
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ•´åˆæ€§ãƒ†ã‚¹ãƒˆè¿½åŠ 
- Phase A3æ©Ÿèƒ½çµ±åˆãƒ†ã‚¹ãƒˆå®Œæˆ

### **ğŸ“‹ Phase 3: Phase A3æ©Ÿèƒ½å®Œå…¨å®Ÿè£…ï¼ˆHigh Priority - 2æ™‚é–“ï¼‰**

#### **3.1 ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½å®Œæˆ**
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ—è¿½åŠ å®Œäº†å¾Œã®æ©Ÿèƒ½çµ±åˆ
- UIç”»é¢å®Ÿè£…ï¼ˆForgotPassword.razor/ResetPassword.razorï¼‰
- smtp4devçµ±åˆãƒ†ã‚¹ãƒˆ

#### **3.2 èªè¨¼æ©Ÿèƒ½çµ±åˆç¢ºèª**
- Remember Meæ©Ÿèƒ½æœ€çµ‚ç¢ºèª
- ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½çµ±åˆç¢ºèª
- èªè¨¼ãƒ•ãƒ­ãƒ¼å…¨ä½“ã®E2Eãƒ†ã‚¹ãƒˆ

### **ğŸ“‹ Phase 4: å“è³ªä¿è¨¼ãƒ»å®Œäº†ç¢ºèªï¼ˆMedium Priority - 1æ™‚é–“ï¼‰**

#### **4.1 ä»•æ§˜æº–æ‹ 100%é”æˆç¢ºèª**
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸100%ä¸€è‡´ç¢ºèª
- æ©Ÿèƒ½ä»•æ§˜æ›¸2.1.1-2.1.3æº–æ‹ 100%ç¢ºèª
- å¦å®šçš„ä»•æ§˜æº–æ‹ ç¢ºèª

#### **4.2 å“è³ªåŸºæº–é”æˆç¢ºèª**
- ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Šç¢ºèª
- å…¨ãƒ†ã‚¹ãƒˆæˆåŠŸç¢ºèª
- Clean ArchitectureåŸå‰‡100%æº–æ‹ ç¢ºèª

## âœ… æˆåŠŸåŸºæº–ãƒ»å®Œäº†åˆ¤å®š

### **æŠ€è¡“çš„å®Œäº†åŸºæº–**
1. âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆæ›¸100%ä¸€è‡´
2. âœ… ApplicationUserè¨­è¨ˆæ›¸100%æº–æ‹ 
3. âœ… 125ä»¶å¤±æ•—ãƒ†ã‚¹ãƒˆ â†’ 0ä»¶é”æˆ
4. âœ… Phase A3æ©Ÿèƒ½100%å®Ÿè£…ãƒ»å‹•ä½œç¢ºèª
5. âœ… ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Šç¶­æŒ

### **å“è³ªå®Œäº†åŸºæº–**
1. âœ… ä»•æ§˜æº–æ‹ ãƒãƒˆãƒªãƒƒã‚¯ã‚¹100%é”æˆ
2. âœ… Clean ArchitectureåŸå‰‡100%æº–æ‹ 
3. âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶100%æº–æ‹ 
4. âœ… TDDå®Ÿè·µã«ã‚ˆã‚‹é«˜å“è³ªå®Ÿè£…ç¢ºèª

### **Phase A3å®Œäº†åŸºæº–**
1. âœ… ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½100%å‹•ä½œ
2. âœ… Remember Meæ©Ÿèƒ½100%å‹•ä½œ
3. âœ… ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ©Ÿèƒ½100%å‹•ä½œ
4. âœ… çµ±åˆãƒ†ã‚¹ãƒˆãƒ»E2Eãƒ†ã‚¹ãƒˆ100%æˆåŠŸ

## ğŸ“ˆ çµ„ç¹”åŠ¹æœæ¸¬å®š

### **ADR_013æº–æ‹ çµ„ç¹”è¨­è¨ˆã®åŠ¹æœ**
- **åˆ†ææ™‚é–“**: 180åˆ†ï¼ˆ6å°‚é–€å½¹å‰²ä¸¦åˆ—å®Ÿè¡Œï¼‰
- **å•é¡Œç™ºè¦‹ç²¾åº¦**: 100%ï¼ˆæ ¹æœ¬åŸå› ç‰¹å®šï¼‰
- **è§£æ±ºç­–å“è³ª**: é«˜ï¼ˆå°‚é–€æ€§ã«ã‚ˆã‚‹è©³ç´°è¨ˆç”»ï¼‰
- **ãƒªã‚¹ã‚¯è»½æ¸›**: æœ€å¤§ï¼ˆãƒ‡ãƒ¼ã‚¿æå¤±ãƒ»å“è³ªåŠ£åŒ–é˜²æ­¢ï¼‰

### **å°‚é–€å½¹å‰²åˆ¥è²¢çŒ®åº¦**
- **DBå°‚é–€å®¶**: Criticalå•é¡Œç™ºè¦‹ãƒ»å…·ä½“çš„ä¿®æ­£æ‰‹é †æä¾›
- **ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å°‚é–€å®¶**: è¨­è¨ˆæ›¸æº–æ‹ ã®æ­£ç¢ºãªå®Ÿè£…æŒ‡é‡
- **ãƒ†ã‚¹ãƒˆå°‚é–€å®¶**: TDDå®Ÿè·µã«ã‚ˆã‚‹å“è³ªä¿è¨¼æˆ¦ç•¥
- **A3æ©Ÿèƒ½å°‚é–€å®¶**: å®Œæˆåº¦è©•ä¾¡ãƒ»æ®‹ä½œæ¥­æ˜ç¢ºåŒ–
- **CAå¢ƒç•Œå°‚é–€å®¶**: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å“è³ªä¿è¨¼ãƒ»å½±éŸ¿è©•ä¾¡
- **å“è³ªä¿è¨¼å°‚é–€å®¶**: ä»•æ§˜æº–æ‹ ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ãƒ»ç¶™ç¶šç›£è¦–ä½“åˆ¶

## ğŸ¯ æ¬¡å›Sessionå®Ÿè£…é–‹å§‹æº–å‚™

### **å®Ÿè¡Œæº–å‚™å®Œäº†çŠ¶æ³**
- âœ… æ ¹æœ¬åŸå› ç‰¹å®šå®Œäº†
- âœ… çµ±åˆè§£æ±ºç­–ç­–å®šå®Œäº†
- âœ… è©³ç´°å®Ÿè£…è¨ˆç”»å®Œäº†
- âœ… æˆåŠŸåŸºæº–æ˜ç¢ºåŒ–å®Œäº†
- âœ… ãƒªã‚¹ã‚¯è©•ä¾¡ãƒ»å¯¾ç­–å®Œäº†

### **å®Ÿè¡Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«**
- **å®Ÿè¡Œæ™‚é–“**: ç´„8æ™‚é–“ï¼ˆ4 Phaseæ§‹æˆï¼‰
- **å®Ÿè¡Œæ–¹å¼**: ADR_013æº–æ‹ TDDå®Ÿè·µãƒ»æ®µéšçš„å“è³ªç¢ºä¿
- **æˆåŠŸç¢ºç‡**: é«˜ï¼ˆ6å°‚é–€å½¹å‰²åˆ†æã«ã‚ˆã‚‹ç¶¿å¯†ãªè¨ˆç”»ï¼‰

**Phase A3å®Œå…¨å®Œäº†ã¨Phase A4ç§»è¡Œæº–å‚™ã«å‘ã‘ã¦ã€çµ±åˆä¿®æ­£ã®å®Ÿè¡Œæº–å‚™ãŒå®Œäº†ã—ã¾ã—ãŸã€‚** ğŸš€

---

**è¨˜éŒ²æ—¥æ™‚**: 2025-07-28  
**åˆ†æè²¬ä»»è€…**: Claude Codeï¼ˆADR_013æº–æ‹ 6å°‚é–€å½¹å‰²çµ±åˆåˆ†æï¼‰  
**æ‰¿èªçŠ¶æ³**: å®Ÿè¡Œæº–å‚™å®Œäº†ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èªå¾…ã¡  
**æ¬¡å›ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: Phase 1ï¼ˆç·Šæ€¥ä¿®æ­£ï¼‰ã®å³åº§å®Ÿè¡Œé–‹å§‹