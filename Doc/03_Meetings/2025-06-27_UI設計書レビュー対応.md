# UI設計書レビュー対応 会議録

**日時**: 2025-06-27（夕方セッション）  
**参加者**: プロジェクトオーナー、Claude Code  
**目的**: UI設計書のレビュー指摘事項対応と機能仕様書作成準備  

## 会議概要

午前中に作成したUI設計書3ファイルのレビューを受けて、8項目の修正指摘事項に対応。画面追加、仕様変更、権限制御の詳細化等を実施し、より実用的で実装可能な設計書に改善。併せて次回の機能仕様書作成に向けた準備も完了。

## レビュー指摘事項と対応

### 1. 01_認証・ユーザー管理画面設計.md への指摘

#### 指摘事項
- **ユーザー登録画面の設計不足**: 画面設計が欠けている
- **ユーザー編集画面の設計不足**: 画面設計が欠けている

#### 対応内容
- **ユーザー登録画面（2.7）追加**:
  - 権限制御: プロジェクト管理者以上のみアクセス可能
  - ロール選択制限: スーパーユーザーは全ロール、プロジェクト管理者は限定ロール
  - 所属プロジェクト: 複数選択可能（チェックボックス）
  - 入力項目: メールアドレス、氏名、初期パスワード、ユーザーロール、所属プロジェクト

- **ユーザー編集画面（2.8）追加**:
  - プロジェクト選択表示: プロジェクト管理者ロール選択時のみ表示
  - パスワードリセット: 管理者による新パスワード設定機能
  - ステータス管理: アクティブ/非アクティブ選択
  - メールアドレス変更不可: セキュリティ考慮

- **その他の修正**:
  - 画面数変更: 6画面 → 8画面
  - 画面遷移図更新: 新規追加画面を含む遷移図に修正

### 2. 02_プロジェクト・ドメイン管理画面設計.md への指摘

#### 指摘事項
- **プロジェクト管理者選択不要**: 登録・編集画面でプロジェクト管理者選択機能は不要
- **データ整合性要件過剰**: ユーザー削除時の引き継ぎ要件は不要

#### 対応内容
- **プロジェクト管理者選択機能削除**:
  - プロジェクト登録画面: 管理者選択UI・バリデーション削除
  - プロジェクト編集画面: 管理者選択UI・バリデーション削除
  - 運用フロー変更: プロジェクト作成 → ユーザー編集で管理者を所属させる

- **管理者割り当て方式変更**:
  - 旧方式: プロジェクト作成時に管理者を選択
  - 新方式: ユーザーロール「プロジェクト管理者」が所属プロジェクトの管理者となる
  - 利点: ロール中心の一貫した権限管理

- **データ整合性要件修正**:
  - 旧仕様: ユーザー削除時は管理者・承認者の引き継ぎが必要
  - 新仕様: ユーザー削除時は引き継ぎ不要（論理削除で対応）

### 3. 03_ユビキタス言語業務画面設計.md への指摘

#### 指摘事項
- **ドメイン列追加**: 編集テーブルにドメイン列を追加（必須選択項目）
- **削除権限制御詳細化**: 状態と権限の組み合わせによる詳細な削除制御

#### 対応内容
- **ドメイン列追加**:
  - 表示項目に「ドメイン」列を追加
  - 必須選択項目として設定
  - プルダウンリスト形式で選択
  - UI構成図の更新: 「ドメイン*」として必須マーク表示

- **削除権限制御の詳細化**:
  - **ドラフト状態**: 
    - 一般ユーザー: 自身作成データのみ削除可能
    - ドメイン承認者以上: すべてのドラフトデータ削除可能
  - **承認待ち状態**: 全ユーザー削除不可（削除ボタン非表示）
  - **承認済み状態**: ドメイン承認者以上のみ削除可能

#### 追加要望への対応
- **物理削除仕様追加**:
  - ドラフトデータ削除時: 物理削除（データベースから完全削除）
  - 承認済みデータ削除時: 論理削除（従来通り）
  - 理由: ドラフトは未確定データのため履歴保持不要

## 主要な仕様変更・確定事項

### プロジェクト管理者の概念整理
- **ロール中心設計**: ユーザーロール「プロジェクト管理者」を基軸とした権限管理
- **所属プロジェクト**: プロジェクト管理者ロールのユーザーが所属するプロジェクトで管理者権限を持つ
- **運用フロー**: 
  1. スーパーユーザーがプロジェクト作成（管理者未設定）
  2. スーパーユーザーがユーザー編集画面でプロジェクト管理者を対象プロジェクトに所属させる
  3. 所属したプロジェクト管理者が該当プロジェクトの管理権限を取得

### 削除処理の最適化
- **状態別削除方式**:
  - ドラフト → 物理削除（ストレージ効率、履歴不要）
  - 承認済み → 論理削除（履歴保持、監査要件）
- **権限別削除制御**:
  - 一般ユーザー → 自作ドラフトのみ
  - 承認者以上 → ドラフト全て + 承認済み

### ドメイン選択の必須化
- **入力効率向上**: ドメイン選択を必須とすることで用語の分類を明確化
- **承認フロー最適化**: ドメインが確定していることで適切な承認者への振り分けが可能
- **検索・分析向上**: ドメイン別の用語管理・分析が正確に実行可能

## 技術実装への影響

### データベース設計への影響
- **ユーザー-プロジェクト関連**: 多対多関係の中間テーブル設計
- **削除フラグ管理**: 物理削除・論理削除の適切な実装
- **権限判定**: ロール・所属・状態の組み合わせによる複合的な権限判定

### 画面実装への影響
- **動的UI制御**: 権限・状態による削除ボタンの表示/非表示制御
- **バリデーション**: ドメイン必須選択のリアルタイムバリデーション
- **プルダウン制御**: ユーザーの所属プロジェクトに基づくドメイン選択肢の動的変更

## 今回のセッションの成果・評価

### 良好だった点

#### 効率的なレビュー・修正プロセス
- **明確な指摘**: 具体的で実装レベルの修正要求
- **迅速な対応**: 指摘事項を確認しながら順次修正実施
- **品質向上**: レビューにより実用性・整合性が大幅に向上

#### 実用的な仕様への改善
- **運用効率**: プロジェクト管理者割り当ての簡素化
- **権限制御**: より細かく実用的な削除権限制御
- **データ管理**: 物理削除・論理削除の適切な使い分け

#### 次回準備の充実
- **確認事項整理**: 機能仕様書作成に必要な要件を6カテゴリに体系化
- **効率的進行**: 事前確認ファイルによるスムーズなセッション準備

### 改善できた点

#### 初期設計の精度向上の必要性
- **ロール概念**: プロジェクト管理者の概念をより早期に整理すべきだった
- **権限制御**: 状態と権限の組み合わせを初期段階で詳細化すべきだった

#### レビュー前の確認強化
- **整合性確認**: 要件定義書との整合性をより詳細に確認すべきだった
- **運用シナリオ**: 実際の運用フローをより深く検討すべきだった

## 次回への引き継ぎ・計画

### 機能仕様書作成の準備完了

#### 作成済み確認事項ファイル
- **ファイル**: `/Doc/01_Requirements/Draft/機能仕様書_追加要件.md`
- **内容**: 6カテゴリ・詳細な確認項目を記載
- **確認項目**: 
  1. ビジネスルール・制約事項
  2. バリデーションルール詳細
  3. 通知・メール機能の詳細
  4. 検索・ソート機能の詳細
  5. エクスポート機能の詳細
  6. データ整合性・同期機能

#### 次回セッションの流れ
1. **事前確認**: 機能仕様書_追加要件.md への回答入力
2. **機能仕様書作成**: 確認した要件を基にした詳細仕様作成
3. **ユーザーストーリー作成**: 要件定義フェーズ完成

### 要件定義フェーズ完成に向けて

#### 残り作業（2ファイル）
- **機能仕様書**: 各機能の詳細仕様・ビジネスルール・制約事項
- **ユーザーストーリー**: ユーザー視点での機能要求・優先度設定

#### 完成時の成果物
- 要件定義書 ✅
- 機能仕様書 ⏳
- ユーザーストーリー ⏳
- UI設計書（3ファイル） ✅

## 重要な申し送り事項

### 修正された仕様の実装影響
- **プロジェクト管理者**: ロール中心の権限管理実装
- **削除処理**: 状態別の物理削除・論理削除実装
- **ドメイン必須**: 入力・編集時のドメイン選択必須化

### A5:SQL Mk-2 連携要件
- **DDL出力**: テーブル・列コメント必須設定
- **論理名設定**: 日本語論理名の適切な設定
- **ER図活用**: A5:SQLの自動生成機能活用

### 次フェーズへの準備
- **データベース設計**: UI設計書の仕様を反映したDB設計
- **システム設計**: 修正された権限制御・削除処理の実装方針
- **技術PoC**: F# + EF Core + Blazor Server の動作検証

## 学んだこと・今後への活用

### レビュープロセスの価値
- **実装視点**: 理論的設計と実装・運用の現実のバランス
- **段階的改善**: 大枠 → 詳細 → レビュー → 修正の効果的なサイクル
- **ステークホルダー視点**: 実際の利用者視点での仕様見直しの重要性

### 権限制御設計の複雑性
- **多次元制御**: ロール・状態・所有者等の複合的な権限判定
- **運用シナリオ**: 実際の業務フローを考慮した権限設計
- **技術制約**: 実装容易性と業務要件のバランス

### プロジェクト管理手法
- **事前準備**: 効率的セッション進行のための準備の重要性
- **文書管理**: 修正履歴・決定事項の体系的な記録
- **継続改善**: レビュー → 修正 → 次工程準備の一貫した流れ

---

**記録者**: Claude Code  
**承認者**: プロジェクトオーナー  
**次回予定**: 機能仕様書・ユーザーストーリー作成による要件定義フェーズ完成  
**状態**: UI設計書修正完了、機能仕様書作成準備完了