# 縦方向スライス実装マスタープラン（改訂版）

**目的**: プロジェクト全体の縦方向スライス実装戦略・順序・分割の統一管理
**適用範囲**: 全Phase実装・phase-start Command・プロジェクト管理
**作成日**: 2025-08-18
**改訂日**: 2025-09-22（Phase A実績・要件分析による全面見直し）
**元情報**: 要件定義書・機能仕様書・Phase A実績分析

## 🎯 実装戦略・基本方針

### 縦方向スライス実装アプローチ
- **概念**: 各機能について全層（Domain→Application→Infrastructure→Web）を貫通する最小動作版を優先実装
- **価値**: 早期価値提供・段階的検証・技術リスク分散・継続的フィードバック
- **Clean Architecture適用**: 境界整合性確保・F#↔C#統合・型変換システム検証

### Phase A実績から学んだ教訓
- **当初計画**: A1-A3（3段階）
- **実際実績**: A1-A9（9段階・300%拡大）
- **拡大要因**: 技術基盤確立・品質向上・技術負債解消・UI/UX改善

## 📋 Phase実装順序（確定）

### A. ユーザー管理機能 → B. プロジェクト管理機能 → C. ドメイン管理機能 → D. ユビキタス言語管理機能

**決定根拠**:
- **依存関係ベース**: A→B→C→Dの順で技術的依存関係が構築される
- **技術基盤確立**: A完了時点でClean Architecture基盤・認証システム・型変換システムが確立
- **価値駆動**: 各Phaseで独立した価値を提供・段階的ユーザー価値向上

## 🔄 Phase分割戦略（実績ベース・改訂版）

### 段階的実装アプローチ（5-8段階想定）
各Phaseを**現実的な段階数**で計画：

#### 基本実装段階（1-3）
1. **基本機能実装**: 最小CRUD・基本UI
2. **関連機能実装**: 業務ロジック・関連管理
3. **機能完成**: 高度機能・統合

#### 品質保証段階（4-6）
4. **品質改善**: 技術負債解消・コード品質向上
5. **UI/UX最適化**: ユーザビリティ改善・パフォーマンス最適化
6. **統合テスト**: E2E検証・本番準備

#### 拡張段階（7-8・必要に応じて）
7. **拡張機能**: 高度機能・外部連携
8. **運用最適化**: 監視・ログ・保守機能

## 📊 Phase特性別開発サイクル（改訂版）

### 🟢 中規模Phase（5段階）
**対象**: B（プロジェクト管理）
- **特徴**: プロジェクト・ユーザー関連管理・権限設定
- **期間**: 5-7セッション
- **組織**: 標準SubAgentパターン活用

### 🟡 大規模Phase（6段階）
**対象**: C（ドメイン管理）
- **特徴**: 承認ワークフロー・通知システム・権限階層
- **期間**: 7-9セッション
- **組織**: 専門性強化SubAgentパターン

### 🔴 超大規模Phase（7-8段階）
**対象**: D（ユビキタス言語管理）
- **特徴**: 状態管理・版管理・Excel風UI・外部連携
- **期間**: 10-12セッション
- **組織**: 複雑Phase対応SubAgentパターン

## 🎯 動作確認戦略（2段階アプローチ・全Phase共通原則）

**策定日**: 2025-10-06（Phase B1完了時）
**適用範囲**: Phase B・C・D全Phase

### 基本原則

#### 2段階動作確認アプローチ
各Phaseの実装完了を段階的に確認することで、効率的なフィードバックループを実現：

1. **中間確認（Phase X3完了後）**: 機能完成時点での確認
   - **目的**: ビジネスロジック・機能完全性の確認
   - **タイミング**: 基本実装段階完了直後・品質保証段階開始前
   - **フィードバック活用**: 品質改善・UI/UX最適化・統合テストに反映

2. **本格確認（Phase X5-X8完了後）**: 最終品質確認時点での確認
   - **目的**: UI/UX・品質・パフォーマンスの最終確認・Phase完了承認
   - **タイミング**: 品質保証段階完了直後・次Phase開始前
   - **成果物**: Phase完了承認・次Phase移行判断

#### 動作確認不実施原則
- **Phase X1-X2完了時**: 機能不完全（実装率50%未満）のため動作確認不実施
- **理由**: 不完全な機能での確認は非効率・誤った印象を与えるリスク

### 戦略的価値

#### メリット
- ✅ **早期フィードバック**: 機能完成時点でビジネスロジック確認
- ✅ **効率的改善**: 中間確認フィードバックを品質保証段階に反映
- ✅ **品質保証**: 最終確認でUI/UX・パフォーマンス確認
- ✅ **段階的承認**: Phase完了承認・次Phase移行判断の明確化

#### Phase B1での教訓
- Phase B1完了時点: 機能不完全（権限6/16パターン・37.5%実装）・UI未最適化
- Phase B3完了時点: 機能完成（権限16/16パターン・100%実装）・意味ある確認が可能
- Phase B5完了時点: UI/UX最適化・E2E検証完了・本番準備完了

### 各Phase適用詳細

- **Phase B**: B3完了後（中間確認）+ B5完了後（本格確認）
- **Phase C**: C3完了後（中間確認）+ C6完了後（本格確認）
- **Phase D**: D3完了後（中間確認）+ D8完了後（本格確認・本番運用承認）

---

## 🎯 Phase別詳細実装計画

### A. ユーザー管理機能 ✅ 完了（2025-09-21）
**実績**: 9段階（A1-A9）・Clean Architecture 97点・技術基盤確立完了

### B. プロジェクト管理機能（改訂計画）

#### Phase B1: プロジェクト基本CRUD ✅ 完了（2025-10-06）
- **対象**: プロジェクト作成・編集・削除・一覧表示
- **技術基盤**: A1-A9で確立された基盤活用
- **検証項目**: プロジェクト固有ビジネスロジック・Clean Architecture適用
- **実績**: 全7Step完了・品質スコア98点・4層完全実装・bUnitテスト基盤構築

#### Phase B-F1: テストアーキテクチャ基盤整備（Phase B1完了後挿入） ✅ 完了（2025-10-13）
- **Phase種別**: 基盤整備Phase（Technical Foundation）
- **実施タイミング**: Phase B1完了後・Phase B2開始前
- **対象Issue**:
  - Issue #43: Phase A既存テストビルドエラー修正（namespace階層化漏れ対応）
  - Issue #40 Phase 1-3: テストアーキテクチャ再構成（レイヤー×テストタイプ分離）
- **技術検証**:
  - ADR_020準拠のテストアーキテクチャ確立
  - 業界標準（.NET Clean Architecture 2024）準拠
  - 7プロジェクト構成（Domain/Application/Contracts/Infrastructure各Unit + Infrastructure.Integration + Web.UI）
- **期待効果**:
  - テスト実行効率30%向上
  - Phase B2以降の最適テスト基盤確立（E2E.Tests準備含む）
  - 技術負債根本解消（F#/C#混在問題・EnableDefaultCompileItems削除）
- **推定期間**: 1-2セッション（6-8時間・5Step構成）
- **実績**: 全5Step完了・品質スコア100点・335/338 tests成功・0 Warning/0 Error維持

#### Phase B2: ユーザー・プロジェクト関連管理 ✅ 完了（2025-10-27）
- **対象**: プロジェクトメンバー管理・UserProjects多対多関連・権限設定
- **技術検証**: 複雑関連データ管理・権限チェック統合
- **実績**: 全8Step完了・品質スコア93点・権限制御16パターン実装・Playwright MCP統合完了

#### Phase B-F2: 技術負債解決・E2Eテスト基盤強化・技術基盤刷新
- **Phase種別**: 基盤整備Phase（Technical Foundation）
- **実施タイミング**: Phase B2完了後・Phase B3開始前
- **対象Issue**: 8件（#54 Phase2, #57, #46, #37, #51 Phase1-2, #52, #59, #55 Phase1-2）
- **主要成果**:
  - Agent Skills Phase 2展開（5-7個作成：tdd-red-green-refactor、spec-compliance-auto、adr-knowledge-base等）
  - Playwright統合基盤刷新（Commands/SubAgent更新・実装責任明確化）
  - DevContainer + Sandboxモード統合（環境構築自動化・二重セキュリティ分離）
  - Claude Code on the Web 検証・並列タスク実行（夜間作業自動化）
  - Phase A/B2 E2Eテスト完全実装（19+3シナリオ・回帰テスト基盤確立）
  - Agent SDK Phase1技術検証完了・Phase2実装（Phase C期間中並行）
- **技術検証**:
  - Agent Skills自律適用による開発効率20-25分/セッション削減
  - DevContainer + Sandbox二重セキュリティ分離（bubblewrap + Docker層分離）
  - Web版並列タスク実行による時間削減50-90%（4 Command同時実行）
  - Agent SDK技術検証（Python/TypeScript選定・Go/No-Go判断）
- **期待効果**:
  - 開発環境セットアップ時間96%削減（1-2時間 → 5分）
  - 承認プロンプト84%削減（Anthropic社内実績ベース）
  - 夜間作業時間50-90%削減（Web版並列実行）
  - ADR_016プロセス遵守違反率0%（Agent SDK Phase2完了時）
  - E2Eテスト基盤完全確立（Phase A/B2回帰テスト自動化）
- **推定期間**: 5-7セッション（25-35時間・9Step構成） + 2-3週間（Issue #55 Phase2・Phase C期間中並行）
- **備考**: Phase B3開始前の技術基盤刷新・Phase C以降の開発基盤強化・技術負債戦略的解消

#### Phase B-F3: プロセス改善・技術負債解消（Phase B3開始前実施・暫定）
- **Phase種別**: 基盤整備Phase（Technical Foundation）
- **実施タイミング**: Phase B-F2完了後・Phase B3開始前
- **対象Issue（暫定）**: 9件（#28, #56, #33, #32, #31, #25, #22, #12, その他Phase B-F2スコープ外Issue）
- **主要対象（暫定）**:
  - Issue #28: ASP.NET Core Identity設計見直し
  - Issue #56: bUnit統合テスト技術課題
  - Issue #33: メトリクス収集・分析機能
  - Issue #32: 自動レポート生成機能
  - Issue #31: プロセス遵守メカニズムの強化
  - Issue #25: スクラム開発プロセスのClaudeCode実装検討
  - Issue #22: 週次総括による重要情報記録プロセス確立
  - Issue #12: スクラム開発完全実現に向けた開発プロセス改善
- **推定期間（暫定）**: 10-15セッション（40-60時間）
- **備考**: Phase B-F2スコープ外Issue・プロセス改善・長期改善テーマ・Phase B-F2完了後に詳細計画策定

#### Phase B3: プロジェクト機能完成
- **対象**: 統計情報・デフォルトドメイン自動作成・削除時影響分析
- **積み残し対応（Phase B-F2より）**:
  - **User Projects UI実装**: ProjectList.razorに`member-management-link`実装
    - **根本原因**: Phase B2でE2Eテスト（user-projects.spec.ts）は作成済みだが、UI側の遷移リンクが未実装
    - **関連Issue**: #59（Phase B-F2 Step7で発見・中断）
    - **実装内容**:
      - ProjectList.razorにプロジェクト一覧→メンバー管理画面への遷移リンク追加
      - data-testid属性（`member-management-link`）設定
      - ProjectMembers.razorは既存（/projects/{ProjectId:guid}/members）
    - **前提条件**: UI実装完了後、Phase B-F2 Step7（E2Eテスト再設計）を再開可能

#### Phase B4: 品質改善・技術負債解消
- **対象**: コード品質向上・技術負債解消・テスト充実

#### Phase B5: UI/UX最適化・統合テスト
- **対象**: ユーザビリティ改善・パフォーマンス最適化・E2E検証

#### 🎯 Phase B 動作確認タイミング（2段階アプローチ）

**決定日**: 2025-10-06
**決定根拠**: Phase B1完了時点では機能不完全（権限6/16パターン・UserProjects未実装）、UI未最適化のため、機能完成後＋UI最適化後の2段階確認が効率的

##### ✅ Phase B3完了後：中間確認（必須）
**タイミング**: Phase B3完了直後・Phase B4開始前
**目的**: ビジネスロジック・機能完全性の確認
**確認項目**:
- 全4ロール（SuperUser/ProjectManager/DomainApprover/GeneralUser）動作確認
- プロジェクトCRUD（16パターン完全実装）動作確認
- UserProjectsテーブル・プロジェクトメンバー管理動作確認
- デフォルトドメイン自動作成・詳細検証
- 統計情報・削除時影響分析動作確認

**フィードバック活用**:
- Phase B4: 品質改善・技術負債解消に反映
- Phase B5: UI/UX最適化に反映

##### ✅ Phase B5完了後：本格確認（必須）
**タイミング**: Phase B5完了直後・Phase C開始前
**目的**: UI/UX・品質・パフォーマンスの最終確認・Phase B完了承認
**確認項目**:
- Phase B3確認内容すべて（再確認）
- UI/UX改善（Phase B3フィードバック反映確認）
- パフォーマンス最適化確認
- E2E検証結果確認
- 本番環境想定の動作確認

**成果物**: Phase B完了承認・Phase C移行判断

##### ❌ Phase B1-B2完了時：動作確認不実施
**理由**: 機能不完全（Phase B1: 37.5%実装、Phase B2: 62.5%実装）・UI未最適化のため非効率

---

### C. ドメイン管理機能（概要計画・6段階想定）

#### Phase C1: ドメイン基本CRUD
- **対象**: ドメイン作成・編集・削除・一覧表示

#### Phase C2: 承認者設定・権限管理
- **対象**: DomainApprovers管理・階層的権限設定

#### Phase C3: 承認ワークフロー実装
- **対象**: 承認申請・承認・却下フロー・状態管理

#### Phase C4: 通知システム統合準備
- **対象**: 承認・却下時の通知基盤（将来拡張対応）

#### Phase C5: 品質改善・技術負債解消
- **対象**: コード品質向上・技術負債解消・テスト充実

#### Phase C6: 統合テスト・最適化
- **対象**: E2E検証・パフォーマンス最適化・本番準備

#### 🎯 Phase C 動作確認タイミング（2段階アプローチ）

**適用方針**: Phase B実績を踏襲・承認ワークフロー完成時点＋最終品質確認時点

##### ✅ Phase C3完了後：中間確認（必須）
**タイミング**: Phase C3完了直後・Phase C4開始前
**目的**: 承認ワークフロー・ビジネスロジックの確認
**確認項目**:
- ドメイン基本CRUD動作確認
- DomainApprovers管理・階層的権限設定確認
- 承認申請・承認・却下フロー・状態管理確認
- 全権限パターン動作確認

**フィードバック活用**:
- Phase C4: 通知システム統合準備に反映
- Phase C5: 品質改善・技術負債解消に反映
- Phase C6: 統合テスト・最適化に反映

##### ✅ Phase C6完了後：本格確認（必須）
**タイミング**: Phase C6完了直後・Phase D開始前
**目的**: UI/UX・品質・パフォーマンスの最終確認・Phase C完了承認
**確認項目**:
- Phase C3確認内容すべて（再確認）
- UI/UX改善（Phase C3フィードバック反映確認）
- E2E検証結果確認
- 本番環境想定の動作確認

**成果物**: Phase C完了承認・Phase D移行判断

---

### D. ユビキタス言語管理機能（概要計画・7-8段階想定）

#### Phase D1: 基本用語CRUD
- **対象**: 用語作成・編集・削除・基本検索

#### Phase D2: ドラフト・正式版状態管理
- **対象**: DraftUbiquitousLang・FormalUbiquitousLang・状態遷移

#### Phase D3: 承認ワークフロー統合
- **対象**: ドラフト→承認→正式版フロー・C Phase成果活用

#### Phase D4: 検索・フィルタ・ソート実装
- **対象**: 高度検索・多条件絞り込み・ソート機能

#### Phase D5: Excel風インライン編集UI
- **対象**: テーブル型UI・リアルタイム編集・ページング

#### Phase D6: Claude Code連携・エクスポート
- **対象**: Markdown出力・CSV出力・外部連携API

#### Phase D7: 品質改善・技術負債解消
- **対象**: コード品質向上・技術負債解消・テスト充実

#### Phase D8: 統合テスト・運用最適化（必要に応じて）
- **対象**: E2E検証・監視・ログ・保守機能・本番運用準備

#### 🎯 Phase D 動作確認タイミング（2段階アプローチ）

**適用方針**: Phase B・C実績を踏襲・承認ワークフロー統合完成時点＋本番運用準備完了時点

##### ✅ Phase D3完了後：中間確認（必須）
**タイミング**: Phase D3完了直後・Phase D4開始前
**目的**: ユビキタス言語管理コア機能・承認ワークフロー統合の確認
**確認項目**:
- 基本用語CRUD動作確認
- ドラフト・正式版状態管理・状態遷移確認
- ドラフト→承認→正式版フロー確認（Phase C成果活用確認）
- 全権限パターン動作確認（プロジェクト・ドメイン横断）

**フィードバック活用**:
- Phase D4: 検索・フィルタ・ソート実装に反映
- Phase D5: Excel風インライン編集UIに反映
- Phase D6-D8: Claude Code連携・品質改善・統合テストに反映

##### ✅ Phase D8完了後：本格確認（必須）
**タイミング**: Phase D8完了直後・本番運用開始前
**目的**: システム全体の最終確認・本番運用承認
**確認項目**:
- Phase D3確認内容すべて（再確認）
- 検索・フィルタ・ソート機能確認
- Excel風インライン編集UI確認（ユーザビリティ重点確認）
- Claude Code連携・Markdown出力・CSV出力確認
- UI/UX改善（Phase D3フィードバック反映確認）
- E2E検証結果確認
- 監視・ログ・保守機能確認
- 本番運用準備完了確認（パフォーマンス・セキュリティ・可用性）

**成果物**: システム全体完了承認・本番運用開始判断

---

## 🔧 技術検証・継続項目

### Phase A1-A9で確立済み技術基盤
- F#↔C#型変換システム（TypeConverter 1,539行）
- Clean Architecture境界整合性（97点品質）
- ASP.NET Core Identity統合・認証システム統一
- PostgreSQL接続・Entity Framework Core最適化
- Blazor Server認証フロー・ログ管理基盤
- SubAgent専門性活用・TDD実践・KPT管理システム

### 各Phaseでの新規検証項目
- **B1-B5**: プロジェクト管理複雑関連・多対多関係最適化
- **C1-C6**: 承認ワークフロー技術基盤・階層的権限判定・通知システム統合
- **D1-D8**: 状態管理・版管理・Excel風UI技術・外部連携API・大量データ処理

## 📈 段階的詳細化アプローチ

### Phase B詳細計画（即座実行可能）
**Phase B1-B5**: 具体的実装計画・SubAgent選択・技術要件確定

### Phase C・D概要計画（実績ベース見直し）
- **Phase B実績評価**: 実際の段階数・時間・品質を測定
- **C・D計画調整**: B実績を基にした現実的な段階数・期間見直し
- **継続的最適化**: 各Phase完了毎の計画精度向上

## 📊 価値提供・効果測定

### 段階的価値提供（改訂版）
1. **A1-A9完了**: 認証システム・技術基盤確立（**2025-09-21達成**）
2. **B1-B5完了**: プロジェクト管理・チーム機能・権限管理
3. **C1-C6完了**: ドメイン管理・承認ワークフロー・組織化機能
4. **D1-D8完了**: 用語管理・核心価値提供・外部連携・運用機能

### 継続改善・効果測定
- Phase完了毎の実績評価（段階数・時間・品質・技術負債）
- ユーザー価値・運用効果の段階的評価
- 次Phase実装効率・品質向上の確認・計画調整

## 🔄 運用・管理

### phase-start Command連携
- 本ファイルから実装順序・Phase特性・段階別計画を自動取得
- 現在のプロジェクト状況との照合・次期Phase/段階自動判定
- Phase固有準備事項・技術前提条件の確認

### プロジェクト状況管理
- Phase別進捗トラッカーとの整合性確保
- 完了Phase実績・未完了Phase計画の継続的更新
- 実装戦略の継続的改善・最適化・実績ベース調整

### 計画見直しサイクル
- **各Phase完了時**: 実績評価・次Phase計画調整
- **月次**: 全体計画の妥当性評価・戦略見直し
- **四半期**: 長期戦略・技術選択の根本見直し

---

**更新履歴**:
- 2025-08-18: Dailyから抽出・Rules配下に配置・phase-start Command連携対応
- **2025-09-22**: Phase A実績・要件定義書・機能仕様書に基づく全面改訂
  - Phase B: 5段階計画・Phase C: 6段階計画・Phase D: 7-8段階計画
  - 段階的詳細化アプローチ・実績ベース継続見直し体制確立