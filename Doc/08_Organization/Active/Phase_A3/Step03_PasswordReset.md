# Phase A3: Step3 - パスワードリセット機能実装

**Step種別**: UI統合実装  
**作成日**: 2025-07-22  
**実施予定**: 次回セッション  
**Step責任者**: Claude Code  
**想定所要時間**: 120分  

## 📋 Step概要

### Step目的
Step2で構築したメール送信基盤を活用し、完全なパスワードリセット機能を実装する。ASP.NET Core Identityのパスワードリセット機能と統合し、ユーザーが安全にパスワードを再設定できる機能を提供する。

### 主要タスク
1. パスワードリセットtoken生成・検証ロジック実装
2. パスワードリセットUI実装（Blazor Server）
3. メール送信との統合（Step2基盤活用）
4. 既存認証システムとの統合

## 🏢 組織設計

### チーム構成（3チーム体制）

#### Team 1: ドメインロジック・セキュリティチーム
**役割**: パスワードリセットの中核ロジックとセキュリティ機能
**専門領域**: ASP.NET Core Identity、token生成・検証、セキュリティ
**主要タスク**:
- ASP.NET Core Identityのパスワードリセット機能統合
- トークン生成・有効期限管理ロジック
- セキュリティ要件実装（レート制限、セキュリティログ等）
- パスワード複雑性・検証ルール統合

#### Team 2: UI・UX実装チーム
**役割**: ユーザーインターフェースとユーザーエクスペリエンス
**専門領域**: Blazor Server、UI/UX、フォーム処理
**主要タスク**:
- パスワードリセット要求画面実装（メールアドレス入力）
- パスワード再設定画面実装（新パスワード入力）
- フォームバリデーション・エラーハンドリング
- ユーザーフィードバック（成功・エラーメッセージ）表示

#### Team 3: 統合・メール送信チーム  
**役割**: Step2基盤活用とシステム統合
**専門領域**: メール送信統合、システム統合、テスト
**主要タスク**:
- Step2で構築したIEmailSenderサービス活用
- パスワードリセットメールテンプレート設計・実装
- メール送信エラーハンドリング
- 統合テスト・E2Eテスト実装

### 実行計画
```
0:00-0:40 [並行分析・設計]
├── Team 1: Identity統合調査・セキュリティ要件分析
├── Team 2: UI/UX設計・画面遷移設計  
└── Team 3: メールテンプレート設計・統合ポイント分析

0:40-0:80 [並行実装]
├── Team 1: ドメインロジック・セキュリティ実装
├── Team 2: Blazor ServerによるUI実装
└── Team 3: メール統合・テンプレート実装

0:80-0:120 [統合・テスト]
├── 3チーム統合・動作確認
├── E2Eテスト実装・実行
└── セキュリティテスト・パフォーマンステスト
```

## 🎯 期待成果

### 実装成果
- [ ] パスワードリセット要求画面（メールアドレス入力）
- [ ] パスワード再設定画面（新パスワード入力・確認）
- [ ] パスワードリセットメールテンプレート
- [ ] トークン生成・検証・有効期限管理
- [ ] Step2メール送信基盤との統合

### セキュリティ基準
- [ ] ASP.NET Core Identity標準準拠
- [ ] トークン有効期限管理（24時間）
- [ ] レート制限実装（同一IPからの要求制限）
- [ ] セキュリティログ出力
- [ ] CSRF保護・XSS対策

### 品質基準
- [ ] 単体テスト作成（ドメインロジック）
- [ ] 統合テスト作成（メール送信統合）
- [ ] E2Eテスト作成（UI動作確認）
- [ ] パフォーマンステスト（レスポンス時間）

## 📊 技術的詳細

### 主要コンポーネント設計

#### パスワードリセットサービス（Application層）
```fsharp
namespace UbiquitousLanguageManager.Application.Services

type IPasswordResetService =
    // パスワードリセット要求処理
    abstract member RequestPasswordResetAsync: email: string -> Task<Result<unit, string>>
    
    // パスワード再設定処理  
    abstract member ResetPasswordAsync: token: string -> newPassword: string -> Task<Result<unit, string>>
    
    // トークン検証
    abstract member ValidateResetTokenAsync: token: string -> Task<Result<unit, string>>
```

#### パスワードリセット画面（Blazor Server）
- `/Pages/Account/ForgotPassword.razor` - パスワードリセット要求
- `/Pages/Account/ResetPassword.razor` - パスワード再設定
- 対応するPageModelクラス

#### メールテンプレート
```html
<html>
<body>
    <h2>パスワードリセット</h2>
    <p>パスワードリセットの要求を受信しました。</p>
    <p>以下のリンクをクリックして新しいパスワードを設定してください：</p>
    <p><a href="{{resetUrl}}">パスワードを再設定</a></p>
    <p>このリンクは24時間有効です。</p>
</body>
</html>
```

### セキュリティ要件
- トークン有効期限: 24時間
- レート制限: 1IP あたり 5要求/時間
- パスワード要件: 8文字以上、英数字組み合わせ
- ログ出力: すべてのパスワードリセット操作をログ記録

## 🚨 リスク・前提条件

### 技術的前提
- Step2メール送信基盤が正常稼働している
- ASP.NET Core Identity が適切に設定済み
- Smtp4dev または本番SMTPサーバーが利用可能

### 識別されたリスク
1. **セキュリティリスク**: トークンの安全な生成・管理
2. **UI複雑性**: Blazor Serverでの複雑なフォーム処理
3. **統合複雑性**: 既存認証システムとの整合性確保
4. **メール配信**: SPAMフィルタによるメール未達

### リスク対策
- ASP.NET Core Identity標準機能の最大限活用
- セキュリティベストプラクティスの徹底適用
- 段階的統合テストによる品質保証
- メール送信失敗時のユーザーフィードバック

## 🔄 Step実行記録
（実行時に記録）

### 実行開始時刻: 
### 実行終了時刻: 

### 実施内容
（実行時に詳細記録）

### 成果物
（作成したファイル・実装したコンポーネント）

### 発見事項・課題
（実装中に発見した技術的課題・解決策）

## 📋 Step3終了時レビュー
（Step3完了時に記録）

### レビュー実施日時: 
### レビュー結果概要
（組織管理運用マニュアルのレビュー項目に基づく評価）

### 次Step組織設計への反映事項
（Step3の結果を踏まえた組織構成の調整案）

---

**次回更新**: Step3実行時（実行記録・レビュー結果追加）