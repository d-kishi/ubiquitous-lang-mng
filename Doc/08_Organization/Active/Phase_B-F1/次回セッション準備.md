# Phase B-F1 次回セッション準備（Step2実施用）

**作成日**: 2025-10-08
**対象**: Step2（Issue #43完全解決）

---

## 📋 次回セッション開始時の必須確認事項

### 1. プロジェクト状況確認（5分）

```bash
# 現在のブランチ・コミット状況確認
git status
git log -5 --oneline

# ビルド健全性確認
dotnet build

# 成功基準: 0 Warning/0 Error（Phase B1完了時状態維持）
```

### 2. Step1成果物確認（5分）

**確認対象**:
- ✅ `Doc/08_Organization/Active/Phase_B-F1/Step01_技術調査結果.md`
- ✅ `Doc/08_Organization/Active/Phase_B-F1/Research/Spec_Analysis_Issue43_40.md`

**確認内容**:
- Issue #43修正対象17件のリスト
- 3パターンの修正方法
- EnableDefaultCompileItems削除手順

### 3. Step2実施準備確認（3分）

- [ ] Step2実施時間確保（45分-1時間）
- [ ] unit-test SubAgent使用確認
- [ ] Step2目的理解（Issue #43完全解決）

---

## 🎯 Step2実施計画（詳細）

### Step目的
Phase A既存テスト17件のnamespace階層化適用・EnableDefaultCompileItems技術負債解消

### 実施内容（45分-1時間）

#### 1. 修正対象ファイル特定（5分）
**参照**: `Research/Spec_Analysis_Issue43_40.md`の修正対象ファイル一覧

**優先順位**:
- 高優先度: 12件（Authentication中心）
- 中優先度: 5件（Common中心・複数境界文脈）

#### 2. using文一括修正（30分）
**SubAgent**: unit-test

**修正パターン**:

##### パターン1: Authentication境界文脈中心（12件）
```csharp
// 削除
using UbiquitousLanguageManager.Domain;

// 追加
using UbiquitousLanguageManager.Domain.Common;
using UbiquitousLanguageManager.Domain.Authentication;
```

**対象ファイル**:
1. UserDomainServiceTests.cs
2. UserProfileValueObjectTests.cs
3. PasswordValueObjectTests.cs
4. AuthenticationConverterTests.cs
5. AuthenticationMapperTests.cs
6. AuthenticationServiceTests.cs
7. AuthenticationServiceAutoLoginTests.cs
8. AuthenticationServicePasswordResetTests.cs
9. RememberMeFunctionalityTests.cs
10. AutoLoginIntegrationTests.cs
11. FSharpAuthenticationIntegrationTests.cs

##### パターン2: Common境界文脈中心（3件）
```csharp
// 削除
using UbiquitousLanguageManager.Domain;

// 追加
using UbiquitousLanguageManager.Domain.Common;
```

**対象ファイル**:
1. ValueObjectsTests.cs
2. NotificationServiceTests.cs
3. AuditLoggingTests.cs

##### パターン3: 複数境界文脈（2件）
```csharp
// 削除
using UbiquitousLanguageManager.Domain;

// 追加（必要なBounded Contextのみ）
using UbiquitousLanguageManager.Domain.Common;
using UbiquitousLanguageManager.Domain.Authentication;
using UbiquitousLanguageManager.Domain.ProjectManagement;
```

**対象ファイル**:
1. TypeConvertersExtensionsTests.cs
2. TypeConvertersTests.cs

#### 3. EnableDefaultCompileItems削除（5分）
**ファイル**: `tests/UbiquitousLanguageManager.Tests/UbiquitousLanguageManager.Tests.csproj`

**削除対象**:
```xml
<!-- Line 9: 削除 -->
<PropertyGroup>
  <EnableDefaultCompileItems>false</EnableDefaultCompileItems>
</PropertyGroup>

<!-- Line 31-36: 削除 -->
<ItemGroup>
  <Compile Remove="**\*.fs" />
  <None Include="**\*.fs" />
</ItemGroup>

<!-- Line 59-74: 削除 -->
<ItemGroup Label="Phase B1テスト（有効）">
  <Compile Include="Infrastructure\ProjectRepositoryTests.cs" />
  <Compile Include="Integration\ProjectManagementIntegrationTests.cs" />
  <Compile Include="TestUtilities\TestWebApplicationFactory.cs" />
  <Compile Include="Fixtures\DatabaseFixture.cs" />
</ItemGroup>
```

#### 4. ビルド・テスト実行確認（5分）
```bash
# 全体ビルド確認
dotnet build

# 成功基準: 0 Warning/0 Error

# Phase Aテスト実行確認
dotnet test tests/UbiquitousLanguageManager.Tests

# 成功基準: Phase A既存テスト100%成功
```

---

## ✅ Step2完了基準

- ✅ 17件全修正完了
- ✅ EnableDefaultCompileItems削除完了
- ✅ ビルド成功（0 Warning/0 Error）
- ✅ Phase Aテスト実行成功率100%
- ✅ git commit作成（"Step2: Issue #43完全解決"）

---

## 🚨 リスク対策

### 想定リスク
| リスク | 対策 |
|-------|------|
| typo・namespace誤り | 各ファイル修正後の個別ビルド確認 |
| テスト失敗 | エラーメッセージ確認・即座修正 |
| ビルドエラー長期化 | 10分以上解決不可の場合ロールバック |

### ロールバック手順
```bash
# Step2 commit特定
git log -5 --oneline

# revert実行
git revert [Step2 commit-hash]

# 確認
dotnet build
dotnet test
```

**復旧時間**: 5-10分

---

## 📝 次回セッション開始時のコマンド

### セッション開始
```
セッションを開始します
```

### Step2開始
```
Step2を開始してください
```

または

```
Issue #43の解決を開始してください
```

---

## 🎯 期待成果

### Step2完了後の状態
- ✅ Phase A既存テスト17件のnamespace階層化完了（ADR_019完全準拠）
- ✅ EnableDefaultCompileItems技術負債解消
- ✅ 0 Warning/0 Error維持
- ✅ Phase Aテスト100%成功維持
- ✅ Step3実施準備完了

---

**準備完了**: 2025-10-08
**次回セッション**: Step2実施予定（45分-1時間）
