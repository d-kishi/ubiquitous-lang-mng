# SubAgent・Command最適化 対話シート

**作成日**: 2025-09-20
**目的**: SubAgent・Command体系の改善方針を対話的に決定
**参考**: GitHub Issue #12 "[PROCESS-003] スクラム開発完全実現に向けた開発プロセス改善"

---

## 📊 発見した改善点一覧

### 1. **Command実行の形骸化・実効性不足** ⭐⭐⭐
**現状**:
- session-end Commandに10項目もの作業指示があるが、実際には概要報告のみで終わることが多い
- phase-start/step-startの手順が冗長で、実際のSubAgent選択まで時間がかかりすぎる
- 「ユーザー承認」が多すぎて作業効率を阻害

**影響**:
- 作業効率の低下
- Command本来の目的（品質保証・プロセス遵守）が達成されない
- 形式的な実行に留まる

### 2. **SubAgent活用の不徹底** ⭐⭐⭐
**現状**:
- 失敗パターン: MainAgentが直接作業してしまい、専門性を活かせない（9/15失敗事例）
- 成功パターン: SubAgent専門活用で20分高品質実装（9/10成功事例のcsharp-web-ui）
- 並列実行の未活用: 同一メッセージ内複数Task呼び出しが徹底されていない

**影響**:
- 専門性の未活用による品質低下
- 作業時間の延長
- 技術負債の発生

### 3. **プロセス遵守違反の頻発** ⭐⭐⭐
**現状**:
- ADR_016違反: 手順飛ばし、承認前作業、独断判断が発生
- 対症療法アプローチ: 根本原因分析せずに表面的対応（9/15のデバッグログ追加連鎖）
- 成果物の虚偽報告: SubAgent実行せずに「想定」「シミュレーション」で報告

**影響**:
- 品質の不安定化
- 技術負債の蓄積
- プロジェクト遅延リスク

### 4. **スクラム開発プロセスの未実現** ⭐⭐
**現状**:
- 実行履歴の可視化不足: Command実行の成功/失敗が体系的に記録されていない
- レトロスペクティブ機能の弱さ: 週次総括はあるが、自動的な改善サイクルが回っていない
- 品質メトリクスの不在: Command実行品質の定量評価がない

**影響**:
- 継続的改善の阻害
- 問題の早期発見・対処の遅れ
- Issue #12の要求未達成

### 5. **Command定義の複雑さ・冗長性** ⭐⭐
**現状**:
- session-end: チェックリスト項目が多すぎて実行漏れが発生
- subagent-selection: Pattern A/B/Cの選択基準が曖昧
- step-start: 組織設計に時間がかかりすぎる（90分→9分短縮したが、まだ改善余地あり）

**影響**:
- 実行負荷の増大
- 選択ミスによる効率低下
- Command実行の回避

### 6. **Agent定義の専門性不明確** ⭐⭐
**現状**:
- 重複機能: spec-analysis/spec-compliance/design-reviewの境界が曖昧
- ツール制約の未考慮: F#に対してSerenaMCPが使えない制約が明記されていない
- 成果物継承関係の不明確: Agent間でどの成果物を引き継ぐか不明確

**影響**:
- Agent選択の迷い
- 重複作業の発生
- 成果物の品質低下

### 7. **自動化・効率化の不足** ⭐
**現状**:
- 手動プロセスが多い: Command実行判断、Agent選択、品質確認が全て手動
- テンプレート不足: 日次記録、Phase Summary等のテンプレートがない
- 実行トリガーの活用不足: 自動実行トリガーが定義されているが活用されていない

**影響**:
- 作業負荷の増大
- 手動ミスの発生
- 一貫性の欠如

### 8. **品質保証メカニズムの弱さ** ⭐
**現状**:
- Command実行品質: command-quality-checkはあるが、実際の品質向上に繋がっていない
- SubAgent成果物確認: 物理的存在確認が徹底されていない
- プロセス遵守チェック: チェックリストはあるが、強制力がない

**影響**:
- 品質の不安定化
- プロセス遵守の形骸化
- 継続的改善の阻害

---

## ❓ あなたへの確認事項

### A. 優先度について
上記8つの改善点について、以下の観点から優先度をつけてください：

1. **最高優先（⭐⭐⭐）**: 即座に改善が必要
2. **高優先（⭐⭐）**: Phase B1開始前に改善したい
3. **中優先（⭐）**: 中長期的に改善したい

**あなたの優先度評価**:
```
1. Command実行の形骸化・実効性不足: [⭐⭐]
2. SubAgent活用の不徹底: [⭐⭐⭐]
3. プロセス遵守違反の頻発: [⭐⭐⭐]
4. スクラム開発プロセスの未実現: [⭐]
5. Command定義の複雑さ・冗長性: [⭐⭐⭐]
6. Agent定義の専門性不明確: [⭐⭐⭐]
7. 自動化・効率化の不足: [⭐⭐]
8. 品質保証メカニズムの弱さ: [⭐⭐⭐]
```

### B. 改善アプローチについて
以下のどのアプローチを重視しますか？（複数選択可）

- [x] **段階的改善**: 既存の仕組みを徐々に改善
- [ ] **根本的見直し**: Command・Agent体系を大幅に再設計
- [ ] **自動化重視**: 手動プロセスの自動化を最優先
- [ ] **簡素化重視**: 複雑な仕組みの簡素化を最優先
- [x] **品質保証強化**: 強制力のある品質チェック導入
- [ ] **スクラム機能実装**: Issue #12の要求を最優先で実装

### C. 実装スコープについて
今回のセッションで実装する範囲はどこまでですか？

- [ ] **設計のみ**: 改善方針の決定・設計書作成まで
- [ ] **部分実装**: 最も重要な1-2項目の実装まで
- [ ] **包括実装**: 優先度の高い項目をまとめて実装
- [x] **段階1完了**: Phase B1開始前に必要な改善の完全実装

---

## 💡 あなたの改善アイデア

### 新たな改善点・課題
発見した改善点以外に、あなたが感じている課題や改善したい点があれば記入してください：

```
1. 品質チェックの仕組みを現在session-endに導入していますが、セッション終了のタイミングはコンテキスト圧迫などの事情でも発生するため効果的ではない。
2. SubAgentのmdファイルの記載について、特に品質チェックや実装関連のサブエージェントにはコード事例があるが、これの価値に疑問がある。前提条件のように作用して、逆に各サブエージェントの成果物の品質を落としているのではないか。
3. 現在、各PhaseのStep1で実行する調査系サブエージェントの成果物出力先はDoc\05_Research\Phase_XX配下となっているが、これだと作業中の組織ディレクトリとは別に管理されているので追跡しにくい。
4. コマンド tdd-practice-check は使用されていないのではないか？

```

### 具体的な改善提案
上記の改善点に対する具体的な解決策のアイデアがあれば記入してください：

```
課題点に記載した内容の項番に対応する番号でアイデアを記載していきます。
1. 全体的に効率性よりも精度を重視し、リファクタの発生回数を抑止したい。実装作業は各PhaseのStep毎に実施するわけだが、Stepの実装作業完了後に品質チェックを実施すればよいのではないだろうか。
2. 特に改善アイデアは無い。ClaudeCode自身で評価して対応方針を考えてほしい。
3. Doc\08_Organization\Active\Phase_XX\Research\ 配下に出力するようにしたい。また、完了済みの調査結果はDoc\08_Organization\Completed\Phase_XX\Research\に移動してほしい。
4. このコマンドの立ち位置や価値がわからない。使われていないのであれば削除する。しかしテスト駆動開発は開発プロセスの必要条件であるため、後で実施していたかをチェックするのではなく開発作業を進めるにあたってルールとして組み込んだ方がよい。

```

### GitHub Issue #12との関連
Issue #12 "[PROCESS-003] スクラム開発完全実現に向けた開発プロセス改善" について、どの機能を優先的に実装したいですか？

**Issue #12の主要機能**:
1. コマンド実行履歴の可視化
2. SubAgent実行結果の統合ビュー
3. 自動レポート生成
4. レトロスペクティブ機能
5. スクラムマスター役割の確立

**あなたの優先順位**:
```
1位: [レトロスペクティブ機能]
2位: [自動レポート生成]
3位: [SubAgent実行結果の統合ビュー]
4位: [コマンド実行履歴の可視化]
5位: [スクラムマスター役割の確立]
```

---

## ❓ 追加質問事項

記入内容を確認し、以下の点について追加で確認させてください：

### 1. **品質チェックタイミングについて**
「Step実装作業完了後に品質チェック」という提案について：

**質問**:
- **A案**: step-end-review Commandを強化して、ここに品質チェックを集約する
- **B案**: 新しい「step-quality-check」のようなCommandを作成する

**回答**: 
どちらでもありません。step-startコマンドでStepの設計を行いますが、その結果1つのStepの中でも何段階かの作業Stageに分かれますよね。
設計された作業Stageのうち、実装が完了した後のStageとして品質チェックStageを入れるようにすれば品質チェック作業が漏れることはありません。
step-end-reviewコマンドはStep終了時に実施するものですが、本来は品質チェックの結果で要改善であるならばStepは完了するべきではないですし、Stepの中のStageとして品質チェックを組み込み、改善点があるならばStepは継続するという判断ができるようにしたいです。
従って、step-startコマンドの成果物であるStep設計に、品質チェックStageを組み込むようにした方が良いと思います。


### 2. **SubAgent定義のコード事例について**
コード事例が制約になっている可能性について：

**質問**:
- **A案**: コード事例を完全削除し、原則・方針のみ記載
- **B案**: 「アンチパターン」として「してはいけない例」のみ記載
- **C案**: 最小限の抽象的な例のみ残す

**回答**: [B案]

### 3. **最高優先（⭐⭐⭐）項目の実装順序について**
5つの最高優先項目の実装順序について：

**提案順序**:
1. Agent定義の専門性明確化（他の改善の基盤）
2. SubAgent活用の徹底（専門性を活かす仕組み）
3. プロセス遵守違反の防止（品質の土台）
4. Command定義の簡素化（実行効率向上）
5. 品質保証メカニズム強化（最終チェック）

**質問**: この順序でよろしいでしょうか？

**回答**: [OKです]

### 4. **TDD実践について**
「開発作業のルールとして組み込む」という提案について：

**提案**:
- SubAgent実行時の必須要件として、各実装系SubAgentに「TDD実践必須」を明記
- step-startで「TDDサイクル開始」を明示的に宣言
- tdd-practice-checkは削除

**質問**: このような方向性でよろしいでしょうか？

**回答**: [OKです]

### 5. **レトロスペクティブ機能（最優先）について**
週次総括を強化する形での実装について：

**提案機能**:
- 自動的な改善提案生成機能を追加
- 改善実施の追跡機能（前週の改善提案が実施されたかチェック）
- 定量的な品質メトリクスの自動集計

**質問**: このような機能でよろしいでしょうか？

**回答**: 
OKです、但し改善提案のすべてを対処するという思想は持ちたくありません。
KPTのKeep, Problemはあなた、サブエージェント、私の三者が持ち寄り、週次総括でTry事項を協議の上選択するという方式を実現したいです。
各種改善事項の記録をどこに持つかは重要ですが、Github Issueとするべきか、あるいはファイルとするべきかは提案頂けると助かります。


---

## 🎯 対話の次ステップ

このシートに記入後、以下の流れで進めます：

1. **記入完了**: あなたの評価・アイデアを記入
2. **内容確認**: 記入内容を確認・追加質問
3. **方針決定**: 改善方針・実装スコープの最終決定
4. **実装計画**: 具体的な実装計画の策定
5. **実装開始**: 決定した改善策の実装

**記入が完了したら、このファイルを保存して完了をお知らせください。**