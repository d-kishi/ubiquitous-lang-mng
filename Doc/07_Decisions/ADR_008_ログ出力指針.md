# ADR_008: ãƒ­ã‚°å‡ºåŠ›æŒ‡é‡

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: æ‰¿èªæ¸ˆã¿  
**æ±ºå®šæ—¥**: 2025-07-06  
**æ±ºå®šè€…**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚ªãƒ¼ãƒŠãƒ¼  
**è¨˜éŒ²è€…**: Claude Code  

## èƒŒæ™¯ãƒ»èª²é¡Œ

### å€‹äººé–‹ç™ºã§ã®å•é¡Œèª¿æŸ»åŠ¹ç‡åŒ–
- **ãƒ‡ãƒãƒƒã‚°åŠ¹ç‡**: å•é¡Œç™ºç”Ÿæ™‚ã®è¿…é€ŸãªåŸå› ç©¶æ˜
- **ã‚·ã‚¹ãƒ†ãƒ å‹•ä½œæŠŠæ¡**: æ‰¿èªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ç­‰ã®è¤‡é›‘ãªæ¥­å‹™ãƒ•ãƒ­ãƒ¼ã®è¿½è·¡
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ**: Blazor Serverãƒ»PostgreSQLã®ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ç‰¹å®š

### Clean Architectureã§ã®ãƒ­ã‚°è²¬å‹™åˆ†é›¢
- **Domainå±¤**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ç´”ç²‹æ€§ç¶­æŒï¼ˆãƒ­ã‚°å‡ºåŠ›ãªã—ï¼‰
- **Applicationå±¤**: ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å®Ÿè¡Œã®è¿½è·¡
- **Infrastructureå±¤**: å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é€£æºã®ç›£è¦–
- **Presentationå±¤**: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã¨UIçŠ¶æ…‹ã®è¨˜éŒ²

### æ§‹é€ åŒ–ãƒ­ã‚°ã«ã‚ˆã‚‹åˆ†æèƒ½åŠ›å‘ä¸Š
- **æ¤œç´¢æ€§**: ãƒ­ã‚°å†…å®¹ã®åŠ¹ç‡çš„ãªæ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- **é›†è¨ˆæ€§**: ã‚¨ãƒ©ãƒ¼é »åº¦ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™ã®åˆ†æ
- **å¯èª­æ€§**: é–‹ç™ºãƒ»é‹ç”¨ã§ã®ç†è§£ã—ã‚„ã™ã„ãƒ­ã‚°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

## æ±ºå®šäº‹é …

## 1. **ãƒ­ã‚°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ»ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**

### 1.1 æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ¡ç”¨
```csharp
// âœ… .NETæ¨™æº–ãƒ­ã‚°ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ä½¿ç”¨
using Microsoft.Extensions.Logging;

// âœ… æ§‹é€ åŒ–ãƒ­ã‚°å¯¾å¿œï¼ˆSerilogæ¨å¥¨ï¼‰
using Serilog;
using Serilog.Events;
```

### 1.2 ãƒ­ã‚°è¨­å®šï¼ˆappsettings.jsonï¼‰
```json
{
  "Serilog": {
    "Using": ["Serilog.Sinks.Console", "Serilog.Sinks.File"],
    "MinimumLevel": {
      "Default": "Information",
      "Override": {
        "Microsoft": "Warning",
        "Microsoft.Hosting.Lifetime": "Information",
        "Microsoft.EntityFrameworkCore": "Warning"
      }
    },
    "WriteTo": [
      {
        "Name": "Console",
        "Args": {
          "outputTemplate": "[{Timestamp:HH:mm:ss} {Level:u3}] {SourceContext}: {Message:lj}{NewLine}{Exception}"
        }
      },
      {
        "Name": "File",
        "Args": {
          "path": "logs/ubiquitous-lang-.txt",
          "rollingInterval": "Day",
          "outputTemplate": "[{Timestamp:yyyy-MM-dd HH:mm:ss.fff zzz} {Level:u3}] {SourceContext}: {Message:lj} {Properties:j}{NewLine}{Exception}"
        }
      }
    ],
    "Enrich": ["FromLogContext", "WithMachineName", "WithThreadId"]
  }
}
```

## 2. **å±¤åˆ¥ãƒ­ã‚°å‡ºåŠ›è²¬å‹™**

### 2.1 Domainå±¤ (F#) - ãƒ­ã‚°å‡ºåŠ›ç¦æ­¢
```fsharp
// âœ… Domainå±¤: ç´”ç²‹é–¢æ•°ã€å¤–éƒ¨I/Oä¾å­˜ãªã—
module TermDomain =
    // âŒ ãƒ­ã‚°å‡ºåŠ›ã¯ä¸€åˆ‡è¡Œã‚ãªã„
    // let logger = ... // ç¦æ­¢
    
    let validateTerm (term: CreateTermCommand) : Result<ValidatedTerm, TermValidationError> =
        // ğŸ¯ ç´”ç²‹ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯: ãƒ­ã‚°å‡ºåŠ›ãªã—
        if String.IsNullOrWhiteSpace(term.Name) then
            Error EmptyTermName
        else
            Ok { Name = term.Name.Trim(); ProjectId = term.ProjectId }
    
    let createApprovalWorkflow (term: Term) (approver: User) : Result<ApprovalWorkflow, WorkflowError> =
        // ğŸ”§ ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ«: å¤–éƒ¨ä¾å­˜ãªã—
        match approver.Role with
        | DomainApprover -> Ok { TermId = term.Id; ApproverId = approver.Id; Status = Pending }
        | _ -> Error (InsufficientApprovalPermissions approver.Id)
```

**Domainå±¤ã®åŸå‰‡**:
- **å®Œå…¨ã«ãƒ­ã‚°å‡ºåŠ›ç¦æ­¢**: å¤–éƒ¨I/Oã‹ã‚‰ã®å®Œå…¨ãªåˆ†é›¢
- **ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§**: å‰¯ä½œç”¨ã®ãªã„ç´”ç²‹é–¢æ•°ã¨ã—ã¦ä¿æŒ
- **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å°‚å¿µ**: ãƒ­ã‚°å‡ºåŠ›è²¬å‹™ã‚’ä»–å±¤ã«ç§»è­²

### 2.2 Applicationå±¤ (F#) - ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãƒ­ã‚°
```fsharp
open Microsoft.Extensions.Logging

// âœ… Applicationå±¤: ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å®Ÿè¡Œã®è¿½è·¡
type UbiquitousLangApplicationService(logger: ILogger<UbiquitousLangApplicationService>, repository: IUbiquitousLangRepository) =
    
    member this.CreateUbiquitousLangAsync (command: CreateUbiquitousLangCommand) (currentUser: User) : Task<Result<UbiquitousLangDto, ApplicationError>> =
        task {
            // ğŸ“Š ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹é–‹å§‹: ä¸»è¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒ­ã‚°å‡ºåŠ›
            logger.LogInformation("UbiquitousLang creation started. UserId: {UserId}, ProjectId: {ProjectId}, UbiquitousLangName: {UbiquitousLangName}", 
                currentUser.Id, command.ProjectId, command.Name)
            
            try
                // ğŸ¯ ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè¡Œ
                let validationResult = UbiquitousLangDomain.validateUbiquitousLang command
                
                match validationResult with
                | Ok validatedUbiquitousLang ->
                    // ğŸ”§ æ°¸ç¶šåŒ–å‡¦ç†
                    let! savedUbiquitousLang = repository.SaveAsync validatedUbiquitousLang
                    
                    // âœ… æˆåŠŸãƒ­ã‚°: çµæœIDã‚’è¨˜éŒ²
                    logger.LogInformation("UbiquitousLang created successfully. UbiquitousLangId: {UbiquitousLangId}, UserId: {UserId}", 
                        savedUbiquitousLang.Id, currentUser.Id)
                    
                    return Ok (UbiquitousLangDto.FromDomain savedUbiquitousLang)
                    
                | Error domainError ->
                    // âš ï¸ ãƒ“ã‚¸ãƒã‚¹ã‚¨ãƒ©ãƒ¼: Warning ãƒ¬ãƒ™ãƒ«ï¼ˆæ­£å¸¸ãªæ¥­å‹™ãƒ•ãƒ­ãƒ¼ï¼‰
                    logger.LogWarning("UbiquitousLang creation failed due to business rule violation. Error: {Error}, UserId: {UserId}", 
                        domainError, currentUser.Id)
                    
                    return Error (DomainError domainError)
                    
            with
            | ex ->
                // âŒ äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼: Error ãƒ¬ãƒ™ãƒ«
                logger.LogError(ex, "Unexpected error during ubiquitous lang creation. UserId: {UserId}, Command: {@Command}", 
                    currentUser.Id, command)
                
                return Error (InfrastructureError ex.Message)
        }
```

**Applicationå±¤ãƒ­ã‚°ã®åŸå‰‡**:
- **ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å¢ƒç•Œ**: é–‹å§‹ãƒ»çµ‚äº†ãƒ»ä¸»è¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨˜éŒ²
- **å€‹äººæƒ…å ±ãƒã‚¹ã‚¯**: æ©Ÿå¾®ãªæƒ…å ±ã¯å‡ºåŠ›ã—ãªã„
- **æ§‹é€ åŒ–ãƒ­ã‚°**: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ§‹é€ åŒ–ã—ã¦æ¤œç´¢ãƒ»é›†è¨ˆã‚’å®¹æ˜“ã«
- **ãƒ¬ãƒ™ãƒ«é©ç”¨**: æ¥­å‹™ã‚¨ãƒ©ãƒ¼ï¼ˆWarningï¼‰vs ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ï¼ˆErrorï¼‰

### 2.3 Infrastructureå±¤ (C#) - å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é€£æºãƒ­ã‚°
```csharp
// âœ… Infrastructureå±¤: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»å¤–éƒ¨APIé€£æºãƒ­ã‚°
public class UbiquitousLangRepository : IUbiquitousLangRepository
{
    private readonly ILogger<UbiquitousLangRepository> _logger;
    private readonly IDbContextFactory<UbiquitousLanguageDbContext> _contextFactory;
    
    public UbiquitousLangRepository(ILogger<UbiquitousLangRepository> logger, IDbContextFactory<UbiquitousLanguageDbContext> contextFactory)
    {
        _logger = logger;
        _contextFactory = contextFactory;
    }
    
    public async Task<Result<UbiquitousLang>> SaveAsync(UbiquitousLang ubiquitousLang)
    {
        // ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œé–‹å§‹: ä¸»è¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
        _logger.LogDebug("Saving ubiquitous lang to database. UbiquitousLangId: {UbiquitousLangId}, Name: {UbiquitousLangName}", 
            ubiquitousLang.Id, ubiquitousLang.Name);
        
        try
        {
            using var context = _contextFactory.CreateDbContext();
            
            var entity = UbiquitousLangConverters.ToEntity(ubiquitousLang);
            context.UbiquitousLangs.Add(entity);
            
            // ğŸ”§ å®Ÿéš›ã®SQLå®Ÿè¡Œå‰ãƒ­ã‚°
            _logger.LogDebug("Executing database save operation. UbiquitousLangId: {UbiquitousLangId}", ubiquitousLang.Id);
            
            var affectedRows = await context.SaveChangesAsync();
            
            // âœ… æˆåŠŸãƒ­ã‚°: å½±éŸ¿è¡Œæ•°å«ã‚€
            _logger.LogInformation("UbiquitousLang saved successfully. UbiquitousLangId: {UbiquitousLangId}, AffectedRows: {AffectedRows}", 
                ubiquitousLang.Id, affectedRows);
            
            var savedDomain = UbiquitousLangConverters.ToDomain(entity);
            return Result<UbiquitousLang>.Success(savedDomain);
        }
        catch (DbUpdateConcurrencyException ex)
        {
            // âš ï¸ æ¥½è¦³çš„æ’ä»–åˆ¶å¾¡: ãƒ“ã‚¸ãƒã‚¹çš„ã«æ„å‘³ã®ã‚ã‚‹ä¾‹å¤–
            _logger.LogWarning(ex, "Concurrency conflict detected during ubiquitous lang save. UbiquitousLangId: {UbiquitousLangId}", ubiquitousLang.Id);
            return Result<UbiquitousLang>.Failure("ãƒ‡ãƒ¼ã‚¿ãŒä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦æ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚");
        }
        catch (SqlException ex)
        {
            // âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼: æŠ€è¡“çš„å•é¡Œ
            _logger.LogError(ex, "Database error during ubiquitous lang save. UbiquitousLangId: {UbiquitousLangId}, ErrorNumber: {ErrorNumber}", 
                ubiquitousLang.Id, ex.Number);
            return Result<UbiquitousLang>.Failure($"ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {ex.Message}");
        }
        catch (Exception ex)
        {
            // ğŸ”¥ äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼: Criticalæƒ…å ±å«ã‚€
            _logger.LogError(ex, "Unexpected error during ubiquitous lang save. UbiquitousLangId: {UbiquitousLangId}", ubiquitousLang.Id);
            return Result<UbiquitousLang>.Failure($"ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªä¿å­˜ä¸­ã«äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {ex.Message}");
        }
    }
}

// âœ… å¤–éƒ¨APIé€£æºã®ä¾‹
public class ExternalApiClient : IExternalApiClient
{
    private readonly ILogger<ExternalApiClient> _logger;
    private readonly HttpClient _httpClient;
    
    public async Task<Result<ApiResponse>> CallExternalApiAsync(ApiRequest request)
    {
        // ğŸ“Š å¤–éƒ¨APIå‘¼ã³å‡ºã—é–‹å§‹
        _logger.LogInformation("External API call started. Endpoint: {Endpoint}, RequestId: {RequestId}", 
            request.Endpoint, request.RequestId);
        
        try
        {
            var response = await _httpClient.PostAsJsonAsync(request.Endpoint, request.Data);
            
            // ğŸ¯ ãƒ¬ã‚¹ãƒãƒ³ã‚¹æƒ…å ±
            _logger.LogInformation("External API call completed. StatusCode: {StatusCode}, RequestId: {RequestId}", 
                response.StatusCode, request.RequestId);
            
            return Result<ApiResponse>.Success(await response.Content.ReadFromJsonAsync<ApiResponse>());
        }
        catch (HttpRequestException ex)
        {
            // ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼: ãƒªãƒˆãƒ©ã‚¤å¯èƒ½
            _logger.LogWarning(ex, "Network error during external API call. Endpoint: {Endpoint}, RequestId: {RequestId}", 
                request.Endpoint, request.RequestId);
            return Result<ApiResponse>.Failure("å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®é€šä¿¡ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
        }
        catch (TaskCanceledException ex)
        {
            // â±ï¸ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: æ˜ç¤ºçš„ãªåŒºåˆ¥
            _logger.LogWarning(ex, "Timeout during external API call. Endpoint: {Endpoint}, RequestId: {RequestId}", 
                request.Endpoint, request.RequestId);
            return Result<ApiResponse>.Failure("å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®å¿œç­”ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚");
        }
    }
}
```

**Infrastructureå±¤ãƒ­ã‚°ã®åŸå‰‡**:
- **å¤–éƒ¨é€£æºç›£è¦–**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»APIå‘¼ã³å‡ºã—ã®æˆåŠŸãƒ»å¤±æ•—ã‚’è¿½è·¡
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æƒ…å ±**: å®Ÿè¡Œæ™‚é–“ãƒ»å½±éŸ¿è¡Œæ•°ç­‰ã®æ€§èƒ½æŒ‡æ¨™
- **ã‚¨ãƒ©ãƒ¼åˆ†é¡**: ä¸€æ™‚çš„ã‚¨ãƒ©ãƒ¼ï¼ˆWarningï¼‰vs æ°¸ç¶šçš„ã‚¨ãƒ©ãƒ¼ï¼ˆErrorï¼‰
- **ãƒªãƒˆãƒ©ã‚¤æƒ…å ±**: è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤å¯¾è±¡ã‹ã©ã†ã‹ã®åˆ¤æ–­ææ–™

### 2.4 Presentationå±¤ (Blazor Server) - UIãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ­ã‚°
```csharp
// âœ… Presentationå±¤: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã¨UIçŠ¶æ…‹ãƒ­ã‚°
public partial class UbiquitousLangManagementComponent : ComponentBase
{
    [Inject] private ILogger<UbiquitousLangManagementComponent> Logger { get; set; } = default!;
    [Inject] private IUbiquitousLangService UbiquitousLangService { get; set; } = default!;
    
    protected override async Task OnInitializedAsync()
    {
        // ğŸ”„ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«: åˆæœŸåŒ–é–‹å§‹
        Logger.LogDebug("UbiquitousLangManagementComponent initialization started. UserId: {UserId}", CurrentUser?.Id);
        
        try
        {
            await LoadUbiquitousLangsAsync();
            
            // âœ… åˆæœŸåŒ–æˆåŠŸ
            Logger.LogDebug("UbiquitousLangManagementComponent initialized successfully. UbiquitousLangCount: {UbiquitousLangCount}, UserId: {UserId}", 
                _ubiquitousLangs.Count, CurrentUser?.Id);
        }
        catch (Exception ex)
        {
            // âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã¸ã®ç›´æ¥å½±éŸ¿
            Logger.LogError(ex, "Failed to initialize UbiquitousLangManagementComponent. UserId: {UserId}", CurrentUser?.Id);
        }
    }
    
    private async Task OnCreateUbiquitousLangAsync()
    {
        // ğŸ¯ ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ: é‡è¦ãªæ¥­å‹™ã‚¤ãƒ™ãƒ³ãƒˆ
        Logger.LogInformation("User initiated ubiquitous lang creation. UserId: {UserId}, UbiquitousLangName: {UbiquitousLangName}", 
            CurrentUser?.Id, _newUbiquitousLangName);
        
        try
        {
            var result = await UbiquitousLangService.CreateUbiquitousLangAsync(new CreateUbiquitousLangCommand 
            { 
                Name = _newUbiquitousLangName, 
                ProjectId = _selectedProjectId 
            });
            
            if (result.IsSuccess)
            {
                // âœ… æ“ä½œæˆåŠŸ: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Œäº†
                Logger.LogInformation("UbiquitousLang creation completed successfully. UbiquitousLangId: {UbiquitousLangId}, UserId: {UserId}", 
                    result.Value.Id, CurrentUser?.Id);
                
                _successMessage = "ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã¾ã—ãŸã€‚";
                await LoadUbiquitousLangsAsync();
            }
            else
            {
                // âš ï¸ æ¥­å‹™ã‚¨ãƒ©ãƒ¼: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
                Logger.LogWarning("UbiquitousLang creation failed due to business rule. Error: {Error}, UserId: {UserId}", 
                    result.Error, CurrentUser?.Id);
                
                _errorMessage = TranslateErrorMessage(result.Error);
            }
            
            // ğŸ”„ Blazor Server: UIçŠ¶æ…‹æ›´æ–°
            StateHasChanged();
        }
        catch (Exception ex)
        {
            // âŒ UIä¾‹å¤–: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®é‡å¤§ãªéšœå®³
            Logger.LogError(ex, "Unexpected error during ubiquitous lang creation UI operation. UserId: {UserId}", CurrentUser?.Id);
            
            _errorMessage = "ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚";
            StateHasChanged();
        }
    }
    
    // ğŸ”„ SignalRæ¥ç¶šçŠ¶æ…‹ã®ãƒ­ã‚°ï¼ˆBlazor Serverå›ºæœ‰ï¼‰
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // ğŸ“¡ SignalRæ¥ç¶šçŠ¶æ…‹: Blazor Serveré‡è¦æŒ‡æ¨™
            Logger.LogDebug("Component first render completed. SignalR connected: {IsConnected}, UserId: {UserId}", 
                await GetSignalRConnectionStatus(), CurrentUser?.Id);
        }
    }
}
```

**Presentationå±¤ãƒ­ã‚°ã®åŸå‰‡**:
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œè¿½è·¡**: é‡è¦ãªæ¥­å‹™ã‚¤ãƒ™ãƒ³ãƒˆã®è¨˜éŒ²
- **UIçŠ¶æ…‹å¤‰åŒ–**: ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ»ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºç­‰ã®çŠ¶æ…‹é·ç§»
- **SignalRç›£è¦–**: Blazor Serverç‰¹æœ‰ã®æ¥ç¶šçŠ¶æ…‹ç›£è¦–
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“**: ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å½±éŸ¿åº¦ã‚’é‡è¦–

## 3. **ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«åŸºæº–**

### 3.1 ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«å®šç¾©
```csharp
// âœ… ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®é©ç”¨åŸºæº–
public static class LoggingLevels
{
    // Trace: æœ€ã‚‚è©³ç´°ãªæƒ…å ±ï¼ˆé–‹ç™ºæ™‚ã®ã¿ï¼‰
    // - é–¢æ•°ã®å¼•æ•°ãƒ»æˆ»ã‚Šå€¤ã®è©³ç´°
    // - ãƒ«ãƒ¼ãƒ—å†…ã®å„é …ç›®å‡¦ç†
    // - è©³ç´°ãªSQLå®Ÿè¡Œè¨ˆç”»
    
    // Debug: é–‹ç™ºæ™‚ã®ãƒ‡ãƒãƒƒã‚°æƒ…å ±
    // - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«
    // - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã®å®Ÿè¡Œ
    // - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆãƒ»ãƒŸã‚¹
    
    // Information: ã‚·ã‚¹ãƒ†ãƒ ã®æ­£å¸¸å‹•ä½œ
    // - ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å®Ÿè¡Œï¼ˆé–‹å§‹ãƒ»å®Œäº†ï¼‰
    // - ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œï¼ˆãƒ­ã‚°ã‚¤ãƒ³ãƒ»é‡è¦æ¥­å‹™ã‚¤ãƒ™ãƒ³ãƒˆï¼‰
    // - å¤–éƒ¨APIå‘¼ã³å‡ºã—æˆåŠŸ
    
    // Warning: äºˆæœŸã—ãªã„äº‹æ…‹ï¼ˆå‡¦ç†ç¶™ç¶šå¯èƒ½ï¼‰
    // - ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«é•å
    // - æ¥½è¦³çš„æ’ä»–åˆ¶å¾¡ç«¶åˆ
    // - å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ä¸€æ™‚çš„ã‚¨ãƒ©ãƒ¼
    // - è¨­å®šå€¤ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    
    // Error: å‡¦ç†ç¶šè¡Œä¸å¯èƒ½ãªã‚¨ãƒ©ãƒ¼
    // - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šå¤±æ•—
    // - äºˆæœŸã—ãªã„ä¾‹å¤–
    // - è¨­å®šä¸æ­£ã«ã‚ˆã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•å¤±æ•—
    
    // Critical: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“åœæ­¢ãƒ¬ãƒ™ãƒ«
    // - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã‚¯ãƒ©ãƒƒã‚·ãƒ¥
    // - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¾µå®³æ¤œçŸ¥
    // - ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§é‡å¤§ç ´ç¶»
}
```

### 3.2 ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«é©ç”¨ä¾‹
```csharp
// âœ… é©åˆ‡ãªãƒ­ã‚°ãƒ¬ãƒ™ãƒ«é©ç”¨
public class UbiquitousLangWorkflowService
{
    public async Task<Result<ApprovalWorkflow>> StartApprovalWorkflowAsync(UbiquitousLang ubiquitousLang, User initiator)
    {
        // ğŸ“Š Information: é‡è¦ãªæ¥­å‹™ãƒ—ãƒ­ã‚»ã‚¹é–‹å§‹
        _logger.LogInformation("Approval workflow starting. UbiquitousLangId: {UbiquitousLangId}, InitiatorId: {InitiatorId}", 
            ubiquitousLang.Id, initiator.Id);
        
        // ğŸ”§ Debug: å†…éƒ¨å‡¦ç†è©³ç´°
        _logger.LogDebug("Checking approval permissions. RequiredRole: {RequiredRole}, UserRole: {UserRole}", 
            "DomainApprover", initiator.Role);
        
        if (initiator.Role != UserRole.DomainApprover)
        {
            // âš ï¸ Warning: ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«é•åï¼ˆæ­£å¸¸ãªæ¥­å‹™ãƒ•ãƒ­ãƒ¼ï¼‰
            _logger.LogWarning("Approval workflow rejected due to insufficient permissions. UbiquitousLangId: {UbiquitousLangId}, UserId: {UserId}, UserRole: {UserRole}", 
                ubiquitousLang.Id, initiator.Id, initiator.Role);
            
            return Result<ApprovalWorkflow>.Failure("æ‰¿èªæ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
        }
        
        try
        {
            var workflow = await _repository.CreateWorkflowAsync(ubiquitousLang, initiator);
            
            // âœ… Information: æ¥­å‹™ãƒ—ãƒ­ã‚»ã‚¹å®Œäº†
            _logger.LogInformation("Approval workflow created successfully. WorkflowId: {WorkflowId}, UbiquitousLangId: {UbiquitousLangId}", 
                workflow.Id, ubiquitousLang.Id);
            
            return Result<ApprovalWorkflow>.Success(workflow);
        }
        catch (Exception ex)
        {
            // âŒ Error: ã‚·ã‚¹ãƒ†ãƒ çš„å•é¡Œ
            _logger.LogError(ex, "Failed to create approval workflow. UbiquitousLangId: {UbiquitousLangId}, InitiatorId: {InitiatorId}", 
                ubiquitousLang.Id, initiator.Id);
            
            return Result<ApprovalWorkflow>.Failure("æ‰¿èªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä½œæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
        }
    }
}
```

## 4. **æ§‹é€ åŒ–ãƒ­ã‚°æ´»ç”¨**

### 4.1 ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ§‹é€ åŒ–
```csharp
// âœ… æ§‹é€ åŒ–ãƒ­ã‚°ã«ã‚ˆã‚‹æ¤œç´¢ãƒ»åˆ†æåŠ¹ç‡åŒ–
public class UbiquitousLangAnalyticsService
{
    public async Task LogUbiquitousLangCreationMetrics(UbiquitousLang ubiquitousLang, User creator, TimeSpan processingTime)
    {
        // ğŸ“Š æ§‹é€ åŒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿: å¾Œã‹ã‚‰é›†è¨ˆãƒ»åˆ†æå¯èƒ½
        _logger.LogInformation("UbiquitousLang creation metrics recorded. " +
            "UbiquitousLangId: {UbiquitousLangId}, " +
            "ProjectId: {ProjectId}, " +
            "CreatorId: {CreatorId}, " +
            "CreatorRole: {CreatorRole}, " +
            "ProcessingTimeMs: {ProcessingTimeMs}, " +
            "UbiquitousLangLength: {UbiquitousLangLength}, " +
            "HasDescription: {HasDescription}",
            ubiquitousLang.Id,
            ubiquitousLang.ProjectId,
            creator.Id,
            creator.Role,
            processingTime.TotalMilliseconds,
            ubiquitousLang.Name.Length,
            !string.IsNullOrEmpty(ubiquitousLang.Description));
    }
    
    public async Task LogWorkflowProgress(ApprovalWorkflow workflow, ApprovalStatus previousStatus, User approver)
    {
        // ğŸ¯ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é€²æ—: æ¥­å‹™åˆ†æç”¨æ§‹é€ åŒ–ãƒ­ã‚°
        _logger.LogInformation("Workflow status changed. " +
            "WorkflowId: {WorkflowId}, " +
            "UbiquitousLangId: {UbiquitousLangId}, " +
            "PreviousStatus: {PreviousStatus}, " +
            "NewStatus: {NewStatus}, " +
            "ApproverId: {ApproverId}, " +
            "ApprovalTimeMinutes: {ApprovalTimeMinutes}",
            workflow.Id,
            workflow.UbiquitousLangId,
            previousStatus,
            workflow.Status,
            approver.Id,
            (DateTime.UtcNow - workflow.CreatedAt).TotalMinutes);
    }
}
```

### 4.2 ãƒ­ã‚°ã‚¯ã‚¨ãƒªä¾‹ï¼ˆSerilogæ§‹é€ åŒ–ãƒ­ã‚°æ´»ç”¨ï¼‰
```csharp
// âœ… ãƒ­ã‚°åˆ†æã‚¯ã‚¨ãƒªä¾‹ï¼ˆå°†æ¥ã®é‹ç”¨ãƒ»åˆ†æã§æ´»ç”¨ï¼‰
/*
-- ç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ“ä½œå±¥æ­´
SELECT * FROM Logs 
WHERE Properties LIKE '%"UserId": "123"%' 
ORDER BY Timestamp DESC;

-- ã‚¨ãƒ©ãƒ¼é »åº¦åˆ†æ
SELECT 
    JSON_EXTRACT(Properties, '$.ErrorCode') as ErrorCode,
    COUNT(*) as Frequency
FROM Logs 
WHERE Level = 'Error' 
    AND Timestamp >= datetime('now', '-7 days')
GROUP BY ErrorCode 
ORDER BY Frequency DESC;

-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ
SELECT 
    AVG(CAST(JSON_EXTRACT(Properties, '$.ProcessingTimeMs') AS REAL)) as AvgProcessingTime,
    JSON_EXTRACT(Properties, '$.CreatorRole') as UserRole
FROM Logs 
WHERE Message LIKE '%UbiquitousLang creation metrics%'
    AND Timestamp >= datetime('now', '-30 days')
GROUP BY UserRole;
*/
```

## æŠ€è¡“çš„æ ¹æ‹ 

### å±¤åˆ¥ãƒ­ã‚°è²¬å‹™åˆ†é›¢ã®åˆ©ç‚¹
1. **Clean Architectureæº–æ‹ **: å„å±¤ã®è²¬å‹™ã«å¿œã˜ãŸé©åˆ‡ãªãƒ­ã‚°é…ç½®
2. **ãƒ‡ãƒãƒƒã‚°åŠ¹ç‡**: å•é¡Œç®‡æ‰€ã®è¿…é€Ÿãªç‰¹å®š
3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ä¸è¦ãªãƒ­ã‚°å‡ºåŠ›ã«ã‚ˆã‚‹æ€§èƒ½åŠ£åŒ–å›é¿

### æ§‹é€ åŒ–ãƒ­ã‚°ã®åˆ©ç‚¹
1. **åˆ†ææ€§**: ãƒ­ã‚°ãƒ‡ãƒ¼ã‚¿ã®å®šé‡åˆ†æãƒ»å‚¾å‘æŠŠæ¡
2. **æ¤œç´¢æ€§**: ç‰¹å®šæ¡ä»¶ã§ã®ãƒ­ã‚°æŠ½å‡ºåŠ¹ç‡åŒ–
3. **ç›£è¦–é€£æº**: ã‚¢ãƒ©ãƒ¼ãƒˆãƒ»ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ§‹ç¯‰ã®åŸºç›¤

### Serilogæ¡ç”¨ã®åˆ©ç‚¹
1. **æŸ”è»Ÿæ€§**: å‡ºåŠ›å…ˆãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®è±Šå¯Œãªé¸æŠè‚¢
2. **æ€§èƒ½**: é«˜ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãªãƒ­ã‚°å‡¦ç†
3. **ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ **: .NETã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã§ã®è±Šå¯ŒãªçŸ¥è¦‹

## å®Ÿè£…å½±éŸ¿

### é–‹ç™ºåŠ¹ç‡ã¸ã®å½±éŸ¿
- **åˆæœŸè¨­å®šã‚³ã‚¹ãƒˆ**: Serilogè¨­å®šãƒ»ãƒ­ã‚°ãƒã‚¤ãƒ³ãƒˆé…ç½®
- **ãƒ‡ãƒãƒƒã‚°åŠ¹ç‡å‘ä¸Š**: å•é¡ŒåŸå› ã®è¿…é€Ÿãªç‰¹å®š

### ã‚·ã‚¹ãƒ†ãƒ é‹ç”¨ã¸ã®å½±éŸ¿
- **ç›£è¦–èƒ½åŠ›å‘ä¸Š**: ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ã®å¯è¦–åŒ–
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡**: ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã®ç®¡ç†ãŒå¿…è¦

## é–¢é€£ADR

- **ADR_007**: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°çµ±ä¸€æ–¹é‡ï¼ˆã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã¨ã®é€£æºï¼‰
- **ADR_010**: å®Ÿè£…è¦ç´„ï¼ˆãƒ­ã‚°å‡ºåŠ›ã®ã‚³ãƒ¡ãƒ³ãƒˆè¨˜è¿°ï¼‰

## ãƒ¬ãƒ“ãƒ¥ãƒ¼å±¥æ­´

| æ—¥ä»˜ | ãƒ¬ãƒ“ãƒ¥ãƒ¼è€… | çµæœ | ã‚³ãƒ¡ãƒ³ãƒˆ |
|------|------------|------|----------|
| 2025-07-06 | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚ªãƒ¼ãƒŠãƒ¼ | æ‰¿èª | Clean Architectureå±¤åˆ¥è²¬å‹™ã¨Serilogæ§‹é€ åŒ–ãƒ­ã‚°ãŒé©åˆ‡ |

---

**æ‰¿èªè€…**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚ªãƒ¼ãƒŠãƒ¼  
**æ‰¿èªæ—¥**: 2025-07-06  
**æœ‰åŠ¹æœŸé–“**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚ºå…¨ä½“  
**æ¬¡å›è¦‹ç›´ã—**: å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†æ™‚