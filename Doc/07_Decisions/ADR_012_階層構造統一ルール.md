# ADR_012: 階層構造統一ルール

**ステータス**: 承認済み  
**決定日**: 2025-07-16  
**決定者**: Claude Code  
**レビュー予定**: 2025-10-16  

## 📋 決定事項

### プロジェクト階層構造の統一ルール

プロジェクト全体で使用する階層構造の命名規則を以下のように統一する：

```
Phase XX（大分類）
├── Step Y（中分類）
│   ├── Step Y-1（小分類・サブステップ）
│   ├── Step Y-2（小分類・サブステップ）
│   └── Step Y-3（小分類・サブステップ）
├── Step Y+1（中分類）
└── Step Y+2（中分類）
```

### 具体例

**Phase A1（基本認証システム）**:
- **Step 1**: 組織設計・分析
- **Step 2**: 実装
  - **Step 2-1**: Infrastructure基盤構築
  - **Step 2-2**: Domain/Application層実装
  - **Step 2-3**: Contracts/Web層実装
- **Step 3**: テスト・レビュー・次期計画

## 🎯 決定の背景

### 問題

Phase A1 Step1の分析結果記録時に、階層構造の命名で混乱が発生：
- プロジェクト状況.mdの「Phase別進捗トラッカー」のPhase
- Step1_Analysis_Results.mdの実装段階を示す「Phase」
- 同じ「Phase」という用語が異なる階層で使用され、混乱を招いた

### 発生した階層構造の問題

**問題のあった構造**：
```
Phase A1 → Step2 → Phase 1-3
```

この構造では「Phase」が2つの異なる階層で使用され、文書理解に混乱を招いていた。

## 🔍 検討した選択肢

### 選択肢1: 「作業段階」表現
```markdown
Phase A1 → Step2 → 作業段階1-3
```
- **利点**: 階層が明確
- **欠点**: 用語が冗長

### 選択肢2: 「サブステップ」表現
```markdown
Phase A1 → Step2 → Step2-1,2-2,2-3
```
- **利点**: 階層構造が直感的
- **欠点**: 特になし

### 選択肢3: 「実装フェーズ」表現
```markdown
Phase A1 → Step2 → 実装フェーズ1-3
```
- **利点**: 内容が明確
- **欠点**: 「フェーズ」が「Phase」と混同される可能性

## ✅ 選択した解決策

**選択肢2（サブステップ表現）**を採用

### 理由

1. **階層構造の直感性**: 「Step 2-1」は明確に「Step 2」のサブステップであることが分かる
2. **命名の一貫性**: 「Step」という用語で統一され、階層レベルのみ数値で区別
3. **拡張性**: 「Step 2-1-A」のようにさらに細分化も可能
4. **理解しやすさ**: 階層構造が数値で表現され、直感的に理解できる

### 実装方針

1. **既存文書の修正**: 問題のあった階層表現を統一ルールに修正
2. **新規文書の適用**: 今後作成する文書は本ルールに従う
3. **レビュー時の確認**: 文書レビュー時に階層構造の一貫性を確認

## 📝 適用範囲

### 対象文書

- プロジェクト状況.md
- Phase別分析結果文書（`/Doc/05_Research/Phase_XX/`）
- 組織設計文書（`/Doc/08_Organization/`）
- セッション記録（`/Doc/04_Daily/`）
- その他、階層構造を含む全文書

### 適用例

**プロジェクト状況.md**:
```markdown
## 📊 Phase別進捗トラッカー

### A. ユーザー管理機能
- [ ] **Phase A1**: 基本認証システム
  - [ ] **Step 1**: 組織設計・分析
  - [ ] **Step 2**: 実装
    - [ ] **Step 2-1**: Infrastructure基盤構築
    - [ ] **Step 2-2**: Domain/Application層実装
    - [ ] **Step 2-3**: Contracts/Web層実装
  - [ ] **Step 3**: テスト・レビュー・次期計画
```

## 🔧 実装詳細

### 命名規則

1. **Phase**: 大分類（機能単位）
   - 例: Phase A1, Phase B1, Phase C1
   - 用途: 機能全体の大きな実装単位

2. **Step**: 中分類（作業単位）
   - 例: Step 1, Step 2, Step 3
   - 用途: Phase内の主要な作業段階

3. **サブステップ**: 小分類（詳細作業単位）
   - 例: Step 2-1, Step 2-2, Step 2-3
   - 用途: Step内の具体的な実装段階

### 階層レベル制限

- **最大階層**: 3階層まで（Phase → Step → サブステップ）
- **拡張ルール**: 必要に応じて「Step 2-1-A」のような4階層目も可能
- **推奨**: 3階層以内で設計し、4階層目は例外的使用に留める

## 🔄 継続的改善

### レビュー観点

1. **階層構造の一貫性**: 全文書で統一された階層表現
2. **命名の適切性**: 階層レベルに応じた適切な命名
3. **理解しやすさ**: 階層構造が直感的に理解できる

### 改善プロセス

- **定期レビュー**: 3ヶ月毎に階層構造の適用状況を確認
- **問題発見時**: 即座にADR更新を検討
- **新規Phase開始時**: 本ルールに基づく階層設計の実施

## 📚 関連文書

- [プロジェクト状況.md](/Doc/プロジェクト状況.md)
- [Phase A1 Step1分析結果](/Doc/05_Research/Phase_A1/Step1_Analysis_Results.md)
- [組織設計文書](/Doc/08_Organization/)

## 🔍 影響範囲

### 即座に修正が必要な文書

1. `/Doc/05_Research/Phase_A1/Step1_Analysis_Results.md` ✅ 修正済み
2. その他Phase別分析結果文書（将来作成分）

### 適用が推奨される文書

1. 組織設計文書の階層表現
2. セッション記録の進捗表現
3. 計画書の作業分割表現

---

**決定の有効性**: 即座に適用開始  
**次回レビュー**: 2025-10-16  
**更新履歴**: 2025-07-16 初版作成