# ADR_013: 組織管理サイクル運用規則

**ステータス**: 承認済み  
**決定日**: 2025-07-16  
**決定者**: Claude Code  
**レビュー予定**: 2025-10-16  

## 📋 決定事項

### 組織管理サイクル運用規則の確立

Phase適応型組織化による構造化専門分析・実装において、組織運用の見落とし防止と品質保証を目的とした組織管理サイクル運用規則を確立する。

## 🎯 決定の背景

### 発生した問題

Phase A1 Step1の再実行において、組織管理サイクルの見落としが発生：
- Step終了時の組織レビューチェックリスト実施が漏れた
- 組織設計結果の適切な記録場所（Active配下）への記録が不十分
- 特殊条件下（Step再実行）での運用手順が不明確

### 根本原因

1. **文書構造の複雑化**: プロジェクト状況.mdが肥大化し、重要な運用ルールが埋没
2. **情報の分散配置**: 組織関連情報が複数文書に分散し、全体像把握が困難
3. **継ぎ足し構造**: 段階的追加による可読性低下
4. **注意喚起の不足**: 組織管理サイクルの重要性が十分に強調されていない

## 🚀 実行ガイド（時系列順）

### Phase開始時
1. **組織設計** → `/Doc/08_Organization/Active/Phase_XX_Organization.md`作成
2. **Step1実行** → 共通Step1実行プロセス適用
3. **Step1終了** → 組織レビュー実施・次Step組織設計

### Step実行中
1. **作業実行** → 組織設計に従った専門分析・実装
2. **継続的更新** → 作業進捗に応じた組織構成調整
3. **Active配下記録** → 組織計画・実績の継続的記録

### Step終了時
1. **組織レビュー** → チェックリスト実施・効果測定
2. **ユーザー確認** → レビュー結果の承認取得
3. **次Step組織設計** → 作業特性変化に応じた組織最適化
4. **ユーザー承認** → 組織設計・作業着手の承認取得
5. **次Step開始** → Active配下ファイル更新・実行開始

### Phase終了時
1. **Step統合レビュー** → 全Step効果の統合評価
2. **ファイル移動** → Active→Completed配下へ移動
3. **知識蓄積** → 次Phase計画時の参考資料として活用

## 🔄 基本サイクル

### 標準組織管理サイクル（Phase毎の必須プロセス）

#### Step終了時（必須プロセス）
**🔴 最重要**: 各Step終了時に必ず実施

**実行タイミング**: Step目標達成完了・品質確認完了の**直後**（次Step着手前）

🚨 **Claude必須実行チェックリスト（Step終了時）**
```
Step終了時に以下を必ず実行し、各段階でユーザーに報告・承認取得:

□ Step終了時組織レビュー実施
  - 組織レビューチェックリスト（/Doc/08_Organization/組織レビューチェックリスト.md）実施
  - Phase組織ファイルにレビュー結果概要を記録
  - レビュー結果をユーザーに報告・承認依頼

□ 技術負債記録・管理
  - 新規技術負債の /Doc/10_Debt/ 配下記録完了
  - スタブメソッド実装時の理由・優先度記録完了
  - 技術負債分類・工数見積もり記録完了

□ 次Step組織設計実施
  - 作業特性変化に応じた組織構造最適化
  - 組織設計結果をユーザーに報告・承認依頼

□ 次Step作業着手準備
  - Active配下ファイル更新・Step実行結果・次Step計画を反映
  - 作業着手準備完了をユーザーに報告・承認依頼

□ 各段階でユーザー承認取得完了
□ 次Step作業着手承認取得完了
```

**⚠️ 重要**: このチェックリストを実行せずに次Stepに進むことは厳禁

#### Step終了時実行完了報告の義務化

**Claude必須実行手順**:
1. **Step終了判定**: Step目標達成・品質確認完了
2. **チェックリスト実行**: 上記チェックリストを段階的に実行
3. **段階別報告**: 各段階完了時にユーザーに報告・承認依頼
4. **完了報告**: 全チェックリスト完了後に総括報告
5. **承認待ち**: 次Step作業着手承認まで待機

**段階別報告テンプレート**:
```
## 🚨 Step終了時組織レビュー完了報告

組織レビューを完了しました：
[レビュー結果概要]

次Step組織設計の承認をお願いします。
```

```
## 🚨 次Step組織設計完了報告

次Step組織設計を完了しました：
[組織設計結果概要]

次Step作業着手準備の承認をお願いします。
```

```
## 🚨 Step終了時チェックリスト完了報告

Step終了時の全プロセスを完了しました：
□ 組織レビュー完了
□ 次Step組織設計完了
□ 作業着手準備完了

次Step作業着手の承認をお願いします。
```

#### 品質保証のポイント
- 各Step終了時に必ず組織レビュー実施
- ユーザー確認なしに次Step組織設計・作業着手を行わない
- 組織設計と作業着手の両方でユーザー承認を得る
- Active配下ファイル更新後の確認を徹底

### 共通Step 1実行プロセス（全Phase共通）

#### 標準実行手順
```
1. 【組織設計】 Phase特性に応じた専門チーム構成決定
2. 【データベース設計書詳細確認】 該当Phase関連テーブル構造・制約・型変換の完全理解
3. 【各チーム専門分析】 並列実行による専門領域の深堀り調査
4. 【統合分析】 各チーム結果の統合・優先順位付け・実装順序決定
5. 【計画詳細化】 Step2以降の具体的作業計画・組織構成変更検討
6. 【詳細記録】 各チーム分析結果と統合結果の体系的記録
```

#### 必須確認事項
```
□ 【組織設計】 Phase特性に応じた専門チーム構成決定
□ 【データベース設計書詳細確認】 必須実施項目:
  - 該当Phase関連テーブル構造の完全理解
  - 外部キー関係・制約条件の確認
  - F#↔C#型変換に必要なデータ型確認
  - 実装対象エンティティの詳細仕様確認
  - ASP.NET Core Identity統合ポイント確認
□ 【各チーム専門分析】 標準情報カテゴリに従った詳細記録
□ 【統合分析】 チーム間連携・依存関係・実装順序の決定
□ 【計画詳細化】 Step2以降の具体的作業計画・組織構成変更検討
□ 【詳細記録】 /Doc/05_Research/Phase_XX/ 配下への体系的記録
```

## 📊 Phase特性別運用

### 🟢 シンプルPhase（3-5Stepサイクル）

**対象**: Phase A1, B1, C1  
**特性**: 基本CRUD・技術基盤検証・最小UI  
**組織規模**: 3-4専門役割  
**レビュー**: 開始・完了のみ  
**テスト重点**: 技術基盤検証・基本動作確認  

**作業順序**:
```
Step 1: 共通Step 1実行プロセス
Step 2: Infrastructure・Web層実装・統合
Step 3: テスト・レビュー・次期計画・組織実績記録
```

### 🟡 中程度Phase（5-7Stepサイクル）

**対象**: Phase A2, B2, C2  
**特性**: 権限管理・UI機能・ビジネスロジック  
**組織規模**: 4-6専門役割  
**レビュー**: 開始・中間・完了  
**テスト重点**: UI/UX・ビジネスロジック検証  

**作業順序**:
```
Step 1: 共通Step 1実行プロセス
Step 2-3: コア実装（Domain→Application→Contracts）
Step 4: 中間レビュー・Infrastructure実装
Step 5-6: Web層・統合・テスト
Step 7: 完了レビュー・改善・次期計画・組織実績記録
```

### 🔴 複雑Phase（7-10Stepサイクル）

**対象**: Phase D2, D3  
**特性**: 状態遷移・リアルタイム通信・複雑UI  
**組織規模**: 6-8専門役割  
**レビュー**: 開始・中間×2・完了  
**テスト重点**: 状態遷移・リアルタイム・複雑UI  

**作業順序**:
```
Step 1: 共通Step 1実行プロセス
Step 2-3: Domain層複雑ロジック実装
Step 4: 中間レビュー①・Application層実装
Step 5-6: Infrastructure層・外部連携実装
Step 7: 中間レビュー②・Web層実装開始
Step 8-9: UI実装・統合テスト・E2Eテスト
Step 10: 完了レビュー・品質確認・次期計画・組織実績記録
```

### 組織設計原則

#### Phase特性による組織最適化
- **並列分析適用**: 課題発見・技術調査・アーキテクチャ検討段階
- **順次統合適用**: 実装・統合・テスト段階（依存関係あり）
- **専門特化適用**: 特定技術領域の集中解決段階

#### 組織継続 vs 変更の判断基準
- **作業性質**: 並列 vs 順次
- **専門性要求**: 深い専門知識 vs 統合調整
- **成果物特性**: 分析・設計 vs 実装・統合
- **課題状況**: 新規発見 vs 既知解決

## 📊 品質保証

### セッション開始時チェックリスト
**🔴 実装フェーズでの必須確認**:
```
□ ADR_013（組織管理サイクル運用規則）確認
□ 前Step組織レビュー結果確認
□ 現Step組織設計の妥当性確認
□ Step終了時必須プロセスの再確認
```

### 品質測定指標
- **組織レビュー実施率**: 100%達成目標
- **Step終了時プロセス遵守率**: 100%達成目標
- **組織設計品質**: レビュー結果の継続的向上

### 品質保証効果
- **見落とし防止**: 組織レビューの制度化
- **運用標準化**: 特殊条件下での明確な手順
- **継続的改善**: 組織効果の継続的測定・改善

### 文脈復元時の品質保証
- **Step1記録内容の完全性確認**: 標準情報カテゴリ全項目記録済み
- **データベース設計書確認結果の妥当性確認**: 技術的整合性確認
- **各チーム分析結果の技術的妥当性確認**: 専門領域の深度確認
- **統合分析結果の実装可能性確認**: 実装順序・依存関係の妥当性
- **計画詳細化結果の実装可能性確認**: 具体的作業計画の実現性

## 🔧 技術実装

### ファイル管理体系

#### 組織設計ファイルの管理単位
**重要**: 組織設計ファイルは**Phase毎**に管理し、**Step毎には分割しない**

**管理方針**:
- 1つのPhase（例: Phase A2）につき1つの組織ファイル
- 各Step終了時にファイル内容を更新（Step1レビュー→Step2組織設計→Step3組織設計...）
- Phase完了時にActive→Completedへ移動

#### 作成・更新場所
```
/Doc/08_Organization/Active/Phase_XX_Organization_Step.md
```
- ファイル名の「_Step」はStep毎の組織設計を含むことを示す
- 実際は1ファイルで全Stepの組織設計を管理

#### 完了時移動先
```
/Doc/08_Organization/Completed/Phase_XX_Organization_Step.md
```

#### レビュー基準
```
/Doc/08_Organization/組織レビューチェックリスト.md
```

#### ファイル管理の利点
1. **一貫性**: Phase全体の組織変遷を1ファイルで追跡可能
2. **効率性**: ファイル分散による管理コスト削減
3. **可読性**: Step間の組織変更理由・経緯が明確
4. **再利用性**: 類似Phaseでの組織設計参考資料として活用

### Step1分析結果記録システム

#### 記録場所・目的
**記録場所**: `/Doc/05_Research/Phase_XX/`（XX=A1,A2,B1,B2...）  
**目的**: Step1分析・計画詳細化結果の体系的記録・再利用・Phase間知見共有

#### 記録内容
- **データベース設計書確認結果**: 該当Phase関連テーブル構造・制約・型変換詳細
- **専門チーム分析結果**: 各専門チームの技術調査・課題発見・解決策
- **統合分析結果**: 優先順位付け・依存関係整理・実装順序決定
- **詳細技術調査**: Gemini調査による深い技術知見・実装パターン
- **実装計画詳細化**: Step2以降の具体的作業計画・組織構成変更

#### 記録ファイル構成
```
/Doc/05_Research/Phase_XX/
├── Step1_Analysis_Results.md                    # 統合分析結果
├── Database_Design_Review.md                    # データベース設計書確認結果
├── [組織チーム1名]_Research.md                   # チーム1専門技術調査
├── [組織チーム2名]_Research.md                   # チーム2専門技術調査
├── [組織チーム3名]_Research.md                   # チーム3専門技術調査
└── [組織チーム4名以降]_Research.md               # 追加チーム技術調査
```

### セッション継続時の文脈復元手順

#### 次セッションでStep2以降開始時の標準プロセス

**実行タイミング**: Step2以降の実装作業に着手する**直前**（コード変更・ファイル作成前）

🚨 **Claude必須実行チェックリスト（Step2以降実行前）**
```
Step2以降実行前に以下を必ず実行し、完了をユーザーに報告:

□ /Doc/05_Research/Phase_XX/ 配下全ファイル読み込み完了
  - Step1_Analysis_Results.md 読み込み・理解完了
  - Database_Design_Review.md 読み込み・理解完了
  - 各組織チーム調査結果ファイル読み込み・理解完了
  
□ /Doc/08_Organization/Active/Phase_XX_Organization_Step.md 読み込み完了
  - Step1組織レビュー結果確認完了
  - 次Step組織設計確認完了
  - 作業体制・役割分担理解完了

□ Step1分析結果に基づく実装計画理解完了
  - 技術的依存関係・実装順序理解完了
  - データベース設計書詳細確認結果理解完了
  - 各専門チーム調査結果理解完了

□ 本チェックリスト完了をユーザーに報告
□ ユーザーの承認を得てからStep2実行開始
```

**⚠️ 重要**: このチェックリストを実行せずにStep2以降を実行することは厳禁

#### 実行完了報告の義務化

**Claude必須実行手順**:
1. **チェックリスト実行**: 上記チェックリストを順次実行
2. **完了報告**: 「Step2実行前チェックリスト完了。承認をお願いします」とユーザーに報告
3. **承認待ち**: ユーザーの承認確認まで待機
4. **実行開始**: 承認取得後にStep2実行開始

**報告テンプレート**:
```
## 🚨 Step2実行前チェックリスト完了報告

以下の確認を完了しました：
□ Step1成果物読み込み完了
□ 組織設計確認完了  
□ 実装計画理解完了

Step2実行の承認をお願いします。
```

### テストコード実装戦略

#### 同時進行パターン（推奨）
- **単体テスト**: 各層実装と同時
- **統合テスト**: レイヤー統合時
- **E2Eテスト**: UI実装完了時
- **受け入れテスト**: Phase完了前

### CLAUDE.md更新指示

**フェーズ別推奨パターン**に本ADRを追加:
```
#### 実装フェーズ推奨
🔴 必読 + ADR_013（組織管理サイクル運用規則） + 関連ADR + 作業対象設計書 + 組織設計
```

## 🔄 特殊条件下の運用

### Step再実行時の組織管理サイクル

#### 標準手順
1. **既存組織設計確認**: Active配下ファイル存在確認
2. **作業特性変化評価**: 前回設計時との差分確認
3. **組織妥当性判定**: 継続 vs 新規設計 vs 部分調整の判断
4. **組織設計実行**: 必要に応じて組織構成調整
5. **通常Step実行**: 改善されたプロセス適用

#### 既存レビュー結果の扱い
- **部分更新**: 新規実行結果で該当Step部分のみ更新
- **統合評価**: 新旧結果の整合性確認
- **品質保証**: 記録内容の完全性・妥当性確認

### 組織設計情報の記録場所統一

#### 組織構成情報は必ずActive配下に記録
- **❌ 不適切**: `/Doc/05_Research/Phase_XX/Step1_Analysis_Results.md`への記録
- **✅ 適切**: `/Doc/08_Organization/Active/Phase_XX_Organization.md`への記録

#### 分析結果での組織情報扱い
- **参照形式**: 「次Step組織設計方針はActive配下ファイルを参照」
- **詳細記録**: Active配下に具体的な組織構成・役割分担を記録

### レビュー最適化方針

#### Phase特性別レビュー頻度
- **🟢 シンプル**: 開始(30分)・完了(1時間)
- **🟡 中程度**: 開始(30分)・中間(30分)・完了(1-2時間)
- **🔴 複雑**: 開始(1時間)・中間①②・完了(2-3時間)

## 🎯 Phase完了時の組織実績管理

### 完了判定
- **Phase完了時**: Step全体のレビュー統合・総括記録
- **ファイル移動**: Active → Completed（実績としての確定）
- **知識蓄積**: 次Phase計画時の参考資料として活用

### 再利用方針
- **完全再利用不可**: 各Phase特性に最適化必要
- **参考活用推奨**: 類似Phase経験の部分的活用
- **継続的進化**: Step毎の組織構造改善・最適化

## 🔄 継続的改善

### 定期レビュー
- **頻度**: 各Phase完了時
- **観点**: 組織管理サイクルの運用効果・問題点
- **改善**: 本ADRの継続的更新

## 🔧 技術負債管理運用規則

### 技術負債記録システム

#### 記録場所の統一
**記録場所**: `/Doc/10_Debt/` 配下
**目的**: 実装過程で発生する技術負債の体系的管理・Phase間継続性確保

#### 技術負債記録ルール
```
各実装過程で技術負債が発生した場合、以下に必ず記載:
/Doc/10_Debt/Phase_XX_Implementation_Planning.md

記録内容:
□ 未実装機能（スタブメソッド）の詳細
□ 実装理由・背景・経緯
□ 優先度（高・中・低）とユーザー価値
□ 技術的依存関係・制約
□ 工数見積もり・実装計画
□ 次Phase実装推奨順序
```

#### 継続運用方針
- **Phase完了時**: 実装状況の更新・新規技術負債の追加
- **Phase開始時**: 優先順位の見直し・実装計画の調整
- **コスト**: 各Phase5分程度の軽量メンテナンス

#### 技術負債分類基準
```
🔴 高優先度: ユーザー価値直結・セキュリティ必須
🟡 中優先度: 運用効率・開発者体験向上
🟢 低優先度: 将来拡張・nice-to-have機能
```

#### スタブメソッド管理
- **Phase A2実績**: 27メソッドのスタブ実装（AuthenticationService 15・NotificationService 9・その他 3）
- **記録要件**: 実装理由・優先度・依存関係を必ず記録
- **判断基準**: コードのみ記録では継続性に問題・軽量記録による解決

### 技術負債品質保証

#### Step終了時の技術負債記録チェック
**🔴 Step終了時必須確認**:
```
□ 新規技術負債の /Doc/10_Debt/ 配下記録完了
□ スタブメソッド実装時の理由・優先度記録完了
□ 技術負債分類・工数見積もり記録完了
```

#### 継続的改善指標
- **記録完全性**: 全技術負債の記録・分類完了率 100%
- **実装計画性**: 次Phase実装順序・優先度の明確化
- **判断効率**: 技術負債実装判断時間の短縮

## 📚 関連文書

- [組織レビューチェックリスト](/Doc/08_Organization/組織レビューチェックリスト.md)
- [ADR_007: エラーハンドリング統一方針](/Doc/07_Decisions/ADR_007_エラーハンドリング統一方針.md)
- [ADR_008: ログ出力方針](/Doc/07_Decisions/ADR_008_ログ出力指針.md)
- [ADR_012: 階層構造統一ルール](/Doc/07_Decisions/ADR_012_階層構造統一ルール.md)
- [プロジェクト状況.md](/Doc/プロジェクト状況.md)
- [技術負債管理](/Doc/10_Debt/)

## 🔍 影響範囲

### 必須適用対象
- **実装フェーズ全Phase**: Phase A1, A2, B1, B2, C1, C2, D1, D2, D3
- **セッション開始時**: 本ADRの必須読み込み
- **Step終了時**: 組織管理サイクルの厳格な適用

---

**決定の有効性**: 即座に適用開始  
**次回レビュー**: 2025-10-16  
**更新履歴**: 2025-07-16 初版作成（Phase A1 Step1組織サイクル見落とし対応）→2025-07-16 構成改良（理解しやすさ向上）