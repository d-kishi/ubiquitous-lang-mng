# インフラ・基盤改善計画

**管理方針**: [ADR_013: 組織管理サイクル運用規則](/Doc/07_Decisions/ADR_013_組織管理サイクル運用規則.md#技術負債管理運用規則)

## 📊 目的

開発基盤・インフラストラクチャの改善・最新化により、開発効率と品質の長期的向上を図る。

---

## Gemini連携のMCP移行

### 実装理由・背景
- **現在**: bash経由でのGemini連携（シェルインジェクションリスク・非構造化データ交換）
- **課題**: セキュリティリスク・エラー処理の複雑性・拡張性の制約
- **解決策**: Model Context Protocol (MCP) による標準化された統合

### 優先度とユーザー価値
- 🟡 **中優先度**: 開発者体験・開発効率向上
- **価値**: 40-60%の開発効率向上・エラー削減・セキュリティ強化
- **影響範囲**: 技術調査・コードレビュー・設計検証の全プロセス

### 技術的依存関係・制約
- **前提条件**: MCP プロトコル理解・SDK習得（40-60時間学習）
- **依存技術**: @anthropic/mcp-server-gemini、JSON-RPC 2.0
- **制約**: エコシステム発展途上・Anthropic仕様依存
- **互換性**: 既存bash方式との並行運用期間必要

### 工数見積もり・実装計画
- **学習・検証フェーズ**: 2-3週間
  - MCPプロトコル理解・基本環境構築
  - Gemini連携テスト・性能比較測定
- **段階的移行フェーズ**: 4-6週間
  - 基本Gemini連携のMCP化
  - データベース・GitHub統合追加
  - 全面MCP環境への移行
- **推奨実装時期**: **Phase B1開始前**（Phase A3完了後）

### 期待効果
- **セキュリティ**: シェルインジェクション等のリスク排除
- **開発効率**: 構造化データ交換による精密な情報共有
- **拡張性**: 標準プロトコルによる新ツール統合の低コスト化
- **品質**: 型安全性によるエラー削減・予期しない不具合防止

### 実装方針
1. **Phase A3**: 現行bash方式継続（メール送信基盤優先）
2. **Phase B1開始前**: MCP Gemini サーバー検証・効果測定
3. **効果確認後**: データベース・GitHub統合等の段階的MCP化
4. **Phase C移行時**: 全面MCP統合環境完成

### 関連ドキュメント
- **詳細調査結果**: 2025-07-24 セッション記録
- **現行連携ガイド**: `/Doc/09_Environment/Gemini連携実践ガイド.md`

---

## SubAgent活用組織化戦略

### 実装理由・背景
- **現在**: 単一Agent内での順次専門役割実行（90-120分）
- **課題**: Context圧迫・AutoCompact頻発・役割切り替え効率低下
- **解決策**: SubAgentによる真の並行組織化・専門性特化・統合効率向上

### 段階的拡張戦略
#### **Phase 1: Step1調査分析の並列化**
- **対象**: 各PhaseのStep1における6-8専門役割調査分析
- **効果**: 90分 → 45-60分（40-50%短縮）
- **開始時期**: Phase A4完了後・Phase B1 Step1で実証実験

#### **Phase 2: 実装フェーズの並列化**
```
並列実装例（Phase B1: プロジェクト管理CRUD）
├─ SubAgent1: F# Domain層実装
├─ SubAgent2: Application層インターフェース実装  
├─ SubAgent3: Infrastructure層実装
├─ SubAgent4: Web層UI実装
└─ MainAgent: 統合・テスト・品質保証
```
- **効果**: 120分 → 60-90分（実装並列化）

#### **Phase 3: SubAgent間協調対話**
- **革新的可能性**: 
  - SubAgent A実装 → SubAgent B仕様検証 → 自動改善サイクル
  - 実装SubAgent ↔ テストSubAgent → 品質向上提案
  - 各層SubAgent間での設計整合性自動確認
- **効果**: 品質向上・仕様準拠100%・自動改善実現

### 優先度とユーザー価値
- 🔴 **高優先度**: Context圧迫解決・開発効率劇的向上
- **価値**: 組織化効率40-50%向上・品質向上・自動改善実現
- **影響範囲**: ADR_013組織管理サイクル全体・全Phase実装効率

### 実証実験計画
- **Phase 1実験**: Phase B1 Step1調査分析での並列SubAgent実行
- **効果測定**: 時間効率・専門性向上・統合品質の定量評価
- **段階展開**: 効果確認後にPhase 2・3へ段階的拡張

### 期待効果
- **Context効率**: AutoCompact大幅削減・必要情報集約化
- **専門性向上**: 各SubAgentの深い専門分析・実装品質向上
- **品質保証**: SubAgent間協調による自動品質向上・仕様準拠確実性
- **開発効率**: 全Phase実装時間40-50%短縮・並行作業効率化

### 実装方針
1. **Phase A4完了後**: SubAgent基本機能理解・実験設計
2. **Phase B1開始**: Step1調査分析でのSubAgent並列化実証実験
3. **効果確認後**: Phase 2・3の段階的実装・組織化戦略全面刷新

### 関連技術課題
- **Context管理**: SubAgent間情報共有・統合方法最適化
- **品質保証**: SubAgent成果物の品質統一・整合性確保
- **エラーハンドリング**: SubAgent失敗時の復旧・代替実行戦略

---

**記録日**: 2025-07-24（基盤改善）・2025-08-01（SubAgent戦略追加）  
**記録者**: Claude Code  
**ステータス**: 🟡 計画中（Phase A4完了後実証実験予定）