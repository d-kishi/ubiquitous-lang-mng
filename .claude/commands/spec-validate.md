# 仕様完全性検証Command

**目的**: 仕様の完全性・実行可能性・整合性を事前検証
**対象**: 仕様書作成・更新時
**実行タイミング**: Phase開始前・仕様変更時・実装前検証
**連携**: spec-analysis SubAgent
**特徴**: SpecKit inspired - 実行可能仕様（Executable Specifications）検証

## 🎯 検証体系（独自拡張機能）

### 仕様完全性検証（40点満点）
```yaml
構文・構造検証: 15点
  - Markdown構文正確性: 5点
  - 仕様項番体系整合性: 5点
  - 階層構造論理性: 5点

内容完全性: 15点
  - 必須項目記載漏れ: 8点
  - 受け入れ基準明確性: 4点
  - 否定的仕様記載: 3点

トレーサビリティ: 10点
  - 上位仕様との整合性: 5点
  - 関連仕様間の整合性: 5点
```

### 実行可能性検証（35点満点）
```yaml
技術実装可能性: 20点
  - 技術的制約確認: 10点
  - アーキテクチャ整合性: 5点
  - パフォーマンス実現可能性: 5点

テスタビリティ: 15点
  - テストケース生成可能性: 8点
  - 自動テスト実装可能性: 4点
  - 受け入れテスト明確性: 3点
```

### 整合性検証（25点満点）
```yaml
仕様間整合性: 15点
  - 要件定義書との整合: 5点
  - データベース設計との整合: 5点
  - UI設計書との整合: 5点

依存関係整合性: 10点
  - 実装順序妥当性: 5点
  - 技術的依存関係: 5点
```

## コマンド実行内容

### 1. 構文・構造検証
```bash
echo "📝 仕様書の構文・構造検証を開始..."
```

**検証項目**:
- [ ] **Markdown構文チェック**: リンク・画像・テーブル構文の正確性
- [ ] **仕様項番体系確認**: 2.1.1形式の階層的項番整合性
- [ ] **必須セクション存在確認**:
  ```yaml
  必須セクション:
    - 概要・目的
    - 受け入れ基準
    - 実装指示
    - テストケース
    - 否定的仕様（制約・禁止事項）
  ```
- [ ] **相互参照リンク検証**: 内部リンク・外部参照の有効性確認

### 2. 実行可能仕様検証（SpecKit inspired）

**実行可能コード検証**:
```bash
echo "🔍 実行可能仕様の妥当性検証..."
```
- [ ] **サンプルコード構文チェック**: C#/F#サンプルコードのコンパイル可能性
- [ ] **テストケース実行可能性**: xUnit/FsUnitサンプルの実行検証
- [ ] **バリデーションロジック検証**: 入力検証ルールの論理的整合性
- [ ] **SQLサンプル検証**: データベースクエリの構文・実行可能性

**実行可能仕様例**:
```csharp
// 仕様2.1.1: ログイン認証（実行可能サンプル）
[Test]
public async Task Login_ValidCredentials_ShouldSucceed()
{
    // Given: 有効な認証情報
    var loginRequest = new LoginRequest
    {
        Email = "admin@ubiquitous-lang.com",
        Password = "su"
    };

    // When: ログイン実行
    var result = await authService.LoginAsync(loginRequest);

    // Then: 認証成功
    Assert.That(result.IsSuccess, Is.True);
    Assert.That(result.UserId, Is.Not.Null);
}
```

### 3. 技術的実装可能性検証

**技術制約確認**:
- [ ] **アーキテクチャ制約**: Clean Architecture境界の適切性
- [ ] **技術スタック制約**: .NET 8.0・F# 8.0・PostgreSQL 16制約内での実現可能性
- [ ] **パフォーマンス制約**: レスポンス時間・メモリ使用量・同時接続数制約
- [ ] **セキュリティ制約**: ASP.NET Core Identity要件・認証認可要件

**実装複雑度評価**:
```yaml
複雑度レベル:
  Level 1（Simple）: 1-2日実装 - 基本CRUD
  Level 2（Standard）: 3-5日実装 - ビジネスロジック含む
  Level 3（Complex）: 1週間以上 - 複雑ワークフロー・外部連携
  Level 4（Critical）: 設計見直し必要 - アーキテクチャ変更要求
```

### 4. 仕様間整合性検証

**文書間整合性**:
```bash
echo "🔗 仕様間整合性の確認..."
```
- [ ] **要件定義書 ↔ 機能仕様書**: 要件の仕様への正確な反映
- [ ] **機能仕様書 ↔ データベース設計書**: データ要件の設計反映
- [ ] **機能仕様書 ↔ UI設計書**: 画面要件の設計反映
- [ ] **ADR ↔ 各仕様書**: アーキテクチャ決定の仕様反映

**依存関係検証**:
- [ ] **実装順序妥当性**: Phase/Step分割の技術的妥当性
- [ ] **前提条件確認**: 依存機能の実装状況確認
- [ ] **影響範囲分析**: 仕様変更の影響範囲特定

### 5. 受け入れ基準・テスト仕様検証

**受け入れ基準明確性**:
```yaml
明確な受け入れ基準の要件:
  - 定量的判定基準: 「90%以上」「3秒以内」等
  - 具体的動作記述: 「〜した場合、〜になる」
  - 例外ケース明記: エラー処理・境界値処理
  - 否定的条件明記: 「〜してはいけない」条件
```

**テスト仕様完全性**:
- [ ] **正常系テストケース**: 基本機能の動作確認
- [ ] **異常系テストケース**: エラーハンドリング・境界値
- [ ] **セキュリティテストケース**: 認証回避・権限昇格テスト
- [ ] **パフォーマンステストケース**: 負荷・ストレステスト

## 📊 検証結果レポート

### 自動生成レポートファイル
```yaml
出力ファイル:
  - /Doc/05_Research/Phase_XX/Spec_Validation_Report.md
  - /Doc/05_Research/Phase_XX/Executable_Specs_Status.json
  - /Doc/05_Research/Phase_XX/Improvement_Recommendations.md
```

### 検証スコアリング（100点満点）
✅ **95-100点**: 実装準備完了 → Phase開始承認
✅ **85-94点**: 軽微改善 → 改善後Phase開始可能
⚠️ **75-84点**: 重要改善必要 → 改善完了後再検証
❌ **75点未満**: 仕様見直し必須 → 全面的な仕様再検討

### 改善提案自動生成
```yaml
提案カテゴリ:
  構文改善: Markdown・項番・リンク修正提案
  内容改善: 記載漏れ・曖昧表現の具体化提案
  実行可能性改善: サンプルコード・テストケース追加提案
  整合性改善: 仕様間の矛盾解消・統一提案
```

## SubAgent連携フロー

### 実行SubAgent
```yaml
主要Agent: spec-analysis
  purpose: 仕様書解析・検証ロジック実行
  強化機能: 実行可能性・整合性検証追加

補完Agent（必要時）:
  design-review: アーキテクチャ整合性確認
  tech-research: 技術的実現可能性調査
```

### 実行タイミング・頻度
```yaml
定期実行:
  - Phase開始前必須検証
  - 仕様変更時自動実行
  - Weekly仕様品質レビュー

自動トリガー:
  - 仕様ファイル更新時（Git hook）
  - Pull Request作成時
  - 実装開始前チェック
```

## 🔄 継続改善・学習機能

### 検証精度向上
- [ ] **過去検証データ活用**: 頻出問題パターンの学習
- [ ] **検証ルール改善**: プロジェクト特性に応じたルール最適化
- [ ] **誤検知削減**: 検証ロジックの精度向上

### ナレッジ蓄積
- [ ] **ベスト仕様パターン**: 高品質仕様書のテンプレート化
- [ ] **問題仕様パターン**: 避けるべき仕様記述パターン
- [ ] **実装困難仕様**: 技術的制約に抵触する仕様パターン

---

**作成日**: 2025-09-25
**目的**: SpecKit的仕様駆動開発の品質保証・事前リスク回避
**効果**: 実装品質向上・手戻り削減・開発効率向上