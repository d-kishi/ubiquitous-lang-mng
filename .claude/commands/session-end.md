# セッション終了Command

**目的**: セッション終了時の必須プロセスを自動実行  
**対象**: 全セッション  
**実行タイミング**: ユーザーが「セッション終了」宣言時

## コマンド実行内容

### 1. セッション目的達成確認（必須）
- [ ] **目的達成判定**: セッション開始時に設定した具体的目的と実績を照合・達成率算出
- [ ] **完了事項確認**: TodoWriteツールで管理されたタスクの完了状況確認
- [ ] **未完了事項整理**: 継続が必要な作業・課題の明確化・次回優先度設定
- [ ] **ユーザー報告**: 目的達成度・完了事項・継続事項を報告しセッション終了承認取得

### 2. Step終了時Command実行（Step完了時）
- [ ] `step-end-review` Command: 包括的品質・進捗確認
- [ ] `spec-compliance-check` Command: 仕様準拠監査（実装作業完了時）
- [ ] `tdd-practice-check` Command: TDD実践確認（実装作業時）

### 3. 成果・実績記録
- [ ] **主要成果整理**: 具体的な完了項目・作成ファイル・変更内容の詳細記録
- [ ] **技術的知見記録**: 新発見・ベストプラクティス・学習事項の具体的記録
- [ ] **問題解決記録**: 発生エラー・解決手法・回避策・再発防止策の詳細記録
- [ ] **創出物確認**: 新規作成ファイル・更新ファイルの品質・内容確認

### 4. 品質・効率評価
- [ ] **目的達成度定量評価**: 100%/80%/60%等の数値化・未達成要因分析
- [ ] **時間効率測定**: 予定時間vs実際時間の比較・効率化要因・時間ロス要因特定
- [ ] **適用手法効果検証**: SubAgent・Commands・並列実行等の具体的効果測定
- [ ] **品質評価**: 成果物品質（0エラー0警告等）・プロセス品質・ユーザー満足度

### 5. 課題・改善管理
- [ ] 発見された課題・問題点の記録（技術的・プロセス的・コミュニケーション）
- [ ] 継続課題の更新（解決済みマーク・新規追加・優先度変更）
- [ ] コミュニケーション改善事項の確認（COM-XXX課題の状況更新）
- [ ] プロセス改善提案（次回セッション以降の改善案）

### 6. Command実行品質確認（必須）
- [ ] **🔧 command-quality-check Command実行** → 今回セッションで実行したCommand品質確認
- [ ] **実行Command一覧確認**: session-start・phase-start・step-start・step-end-review等の実行確認
- [ ] **品質評価記録**: 各Command実行の具体性・完全性・実効性評価
- [ ] **改善提案記録**: Command改善点・プロセス最適化提案の記録

### 7. 次回準備・引き継ぎ
- [ ] 次回セッション予定事項の設定（具体的作業内容・準備事項）
- [ ] 申し送り事項の更新（重要な制約・前提・注意点）
- [ ] 技術的前提条件の整理（開発環境・依存関係・設定状況）
- [ ] Phase状況の更新（現在Phase・次Phase・実装計画）

### 8. 記録・文書化（必須）
- [ ] **セッション記録作成（Issue #34完了まで）**: `/Doc/04_Daily/YYYY-MM/YYYY-MM-DD-{セッション番号}-{セッション概要}.md`に詳細記録
- [ ] **ADR化検討**: 重要な技術選定・アーキテクチャ決定・プロセス決定のADR化要否判断
- [ ] **プロジェクト状況更新**: Serenaメモリー`project_overview`の以下セクション更新
  - 現在のプロジェクト状況（Phase進捗・完了事項）
  - 次回セッション推奨範囲（最優先事項・読み込み推奨ファイル・予想時間配分）
- [ ] **週次総括反映**: 週末セッションの場合は週次総括への重要事項反映確認

### 9. Serenaメモリー更新（必須・差分更新方式）

#### 🔴 重要：既存内容読み込み→差分更新の原則
**全てのメモリー更新は以下の手順で実行**：
1. `mcp__serena__read_memory`で既存内容を読み込み
2. 既存内容を分析・理解
3. 今回セッション分の追記・更新箇所を特定
4. 既存内容＋差分で新内容を構成
5. `mcp__serena__write_memory`で更新

#### 各メモリー更新詳細

- [ ] **project_overview更新（差分更新方式）**:
  - 既存内容読み込み → 該当セクションのみ更新
  - 更新対象：Phase進捗、技術負債状況、次回推奨範囲
  - 維持対象：プロジェクト基本情報、過去Phase記録

- [ ] **development_guidelines更新（差分追記方式）**:
  - 既存内容読み込み → 新ガイドライン・変更のみ追記
  - 追記対象：新規開発方針、プロセス改善、制約変更
  - 維持対象：既存ガイドライン全て

- [ ] **tech_stack_and_conventions更新（差分追記方式）**:
  - 既存内容読み込み → 新発見・新規約のみ追記
  - 追記対象：技術的発見、新規約、新実装パターン
  - 維持対象：既存技術スタック、既存規約

- [ ] **daily_sessions更新（履歴追記＋古記録削除）**:
  - 既存内容読み込み → 本日分追記＋30日超削除
  - 追記：本日セッション記録（日付・内容・成果）
  - 削除：30日より古い記録（日付判定で自動削除）
  - 整理：日付順ソート維持

- [ ] **task_completion_checklist更新（状態更新方式）**:
  - 既存内容読み込み → タスク状態更新・新規追加
  - 更新：完了タスクを[x]マーク、進行中タスク状態更新
  - 追加：新規タスクを適切な優先度位置に挿入
  - 維持：未着手・継続タスクはそのまま保持

- [ ] **メモリー更新品質確認**:
  - 各メモリーの差分更新が適切に実行されたか確認
  - 既存重要情報が維持されているか確認
  - 次回セッションで参照可能な状態か確認

### 10. Command実行完了確認・継続判断

#### 🔴 必須実行確認（自己チェック）
**実行証跡必須確認**:
- [ ] **Write/Editツール実行結果確認**: 以下の必須ファイル作成・更新が実際に実行されたか
  - [ ] `/Doc/04_Daily/YYYY-MM/YYYY-MM-DD.md` 作成済み（Issue #34完了まで・オプション）

- [ ] **mcp__serena__read_memory実行確認**: 各メモリー更新前に既存内容読み込み実行
  - [ ] project_overview読み込み済み
  - [ ] development_guidelines読み込み済み
  - [ ] tech_stack_and_conventions読み込み済み
  - [ ] daily_sessions読み込み済み
  - [ ] task_completion_checklist読み込み済み

- [ ] **mcp__serena__write_memory実行確認**: 差分更新で5種類のメモリー更新
  - [ ] project_overview差分更新実行済み
  - [ ] development_guidelines差分追記実行済み
  - [ ] tech_stack_and_conventions差分追記実行済み
  - [ ] daily_sessions履歴追記実行済み（30日超削除含む）
  - [ ] task_completion_checklist状態更新実行済み

- [ ] **実行内容品質確認**: 各更新内容が具体的・実用的で次回セッションで参照可能か

#### 🔴 実行漏れ防止チェック
- [ ] **抽象的報告の排除**: 「実施しました」ではなく実際のツール呼び出し実行済み
- [ ] **段階的実行**: 各項目を順次実行し実行結果確認してから次項目へ進行済み
- [ ] **自己検証完了**: 上記全項目の実行証跡確認済み

#### 継続・終了判断
- [ ] **Command実行完了確認**: 上記自己チェック全項目が実行完了していることを確認
- [ ] **継続判断**: ユーザーが継続を希望する場合は新たな目的設定を依頼
- [ ] **継続処理**: 継続の場合は新セッション開始プロセスへ移行
- [ ] **終了処理**: 終了の場合は全記録完了確認・次回セッション準備完了宣言

## 実行後アクション
✅ セッション完了 → プロジェクト状況更新・記録完了  
🔄 継続希望 → 新セッション目的設定・session-start Command実行  
⚠️ 未完了事項あり → 該当項目を次回最優先事項に設定

## 関連プロセス
- SubAgent活用: step-end-review, spec-compliance-check, tdd-practice-check Commands
- 記録テンプレート: `/Doc/04_Daily/セッション終了時記録テンプレート.md`
- 管理更新: `/Doc/プロジェクト状況.md`

## 自動実行トリガー
- ユーザー発言: "セッション終了"
- ユーザー発言: "セッションを終了します"  
- ユーザー発言: "終了します"（セッション文脈時）
- ユーザー発言: "セッション終了宣言"